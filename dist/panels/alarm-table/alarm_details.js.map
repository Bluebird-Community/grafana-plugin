{"version":3,"sources":["../../../src/panels/alarm-table/alarm_details.js"],"names":["alarmDetailsAsDirective","restrict","templateUrl","controller","AlarmDetailsCtrl","bindToController","controllerAs","scope","dismiss","TableRenderer","md5","Model","compareStrings","a","b","localeCompare","$scope","backendSrv","contextSrv","datasourceSrv","$q","editFeedback","editor","index","CORRECT_OUTLINED","CORRECT_FILLED","INCORRECT_OUTLINED","INCORRECT_FILLED","alarm","$parent","source","relatedAlarms","length","angular","copy","sort","nodeLabel","reduce","acc","cur","idx","src","ret","current","prev","undefined","push","isHeader","feedbackCorrectCount","feedbackIncorrectCount","severity","label","toLowerCase","severityIcon","getIconForSeverity","situationFeebackEnabled","feebackButton","tabs","ticketingEnabled","ticketerConfig","enabled","self","getDatasource","then","ds","getSituationFeedback","id","feedback","situationFeedback","initalizeFeeback","updateFeedback","hasSituationFeedback","situationFeedbackButton","catch","reason","console","log","getAlarmString","JSON","stringify","detailsLink","detailsPage","substring","indexOf","reductionKey","button","alarmKey","feedbackType","FeedbackTypes","FALSE_POSITIVE","alarmFeedback","OnmsSituationFeedback","situationKey","situationFingerprint","fingerPrint","CORRECT","user","login","form","submitFeedback","submitSituationFeedback","response","submittedFeedback","fb","ifb","fingerprint","situation","btoa","get","type","message"],"mappings":"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","file":"alarm_details.js","sourcesContent":["import { TableRenderer } from \"./renderer\"\nimport md5 from '../../crypto-js/md5';\nimport {Model} from '../../opennms';\n\nconst compareStrings = (a, b) => {\n  return (a || b) ? (!a ? -1 : !b ? 1 : a.localeCompare(b)) : 0;\n};\n\nexport class AlarmDetailsCtrl {\n\n  /** @ngInject */\n  constructor($scope, backendSrv, contextSrv, datasourceSrv, $q) {\n    this.$scope = $scope;\n    this.backendSrv = backendSrv;\n    this.contextSrv = contextSrv;\n    this.datasourceSrv = datasourceSrv;\n    this.editFeedback = false;\n    $scope.editor = { index: 0 };\n\n    this.CORRECT_OUTLINED = \"/public/plugins/opennms-helm-app/img/if_icon-ios7-checkmark-outline_211714.png\";\n    this.CORRECT_FILLED = \"/public/plugins/opennms-helm-app/img/if_icon-ios7-checkmark_211715.png\";\n\n    this.INCORRECT_OUTLINED = \"/public/plugins/opennms-helm-app/img/if_icon-close_211652.png\";\n    this.INCORRECT_FILLED = \"/public/plugins/opennms-helm-app/img/if_icon-close-circled_211650.png\";\n\n    // Save the alarm\n    $scope.alarm = $scope.$parent.alarm;\n    $scope.source = $scope.$parent.source;\n\n    if ($scope.alarm.relatedAlarms && $scope.alarm.relatedAlarms.length > 0) {\n      $scope.relatedAlarms = angular.copy($scope.alarm.relatedAlarms)\n        .sort((a, b) => compareStrings(a.nodeLabel, b.nodeLabel))\n        .reduce((acc, cur, idx, src) => {\n          const ret = acc;\n          const current = cur.nodeLabel;\n          const prev = idx === 0? undefined : src[idx-1].nodeLabel;\n          if (current !== prev) {\n            ret.push({\n              nodeLabel: current,\n              isHeader: true\n            });\n          }\n          ret.push(src[idx]);\n          return ret;\n        }, []);\n    }\n\n    // Feedback Counts\n    $scope.feedbackCorrectCount = 0;\n    $scope.feedbackIncorrectCount = 0;\n\n    // Compute the icon\n    let severity = $scope.alarm.severity.label.toLowerCase();\n    $scope.severityIcon = TableRenderer.getIconForSeverity(severity);\n    $scope.severity = $scope.$parent.severity;\n\n    // Situation Feedback\n    $scope.situationFeebackEnabled = false;\n    $scope.feebackButton = this.CORRECT_OUTLINED;\n\n    // Compute the tabs\n    $scope.tabs = ['Overview', 'Memos'];\n    $scope.ticketingEnabled = $scope.$parent.ticketerConfig && $scope.$parent.ticketerConfig.enabled;\n    if ($scope.ticketingEnabled) {\n      $scope.tabs.push('Ticketing');\n    }\n    // If this is a Situation, collect any correlation feedback previously submitted\n    if ($scope.alarm.relatedAlarms && $scope.alarm.relatedAlarms.length > 0) {\n      $scope.tabs.push('Related Alarms');\n      let self = this;\n      this.getDatasource().then(ds => { return ds.getSituationFeedback(self.$scope.alarm.id) })\n        .then(\n          function (feedback) {\n            $scope.situationFeedback = self.initalizeFeeback();\n            if (feedback && feedback.length > 0) {\n              self.updateFeedback(feedback);\n              $scope.hasSituationFeedback = true;\n            }\n            $scope.situationFeedbackButton = self.situationFeedbackButton();\n            $scope.situationFeebackEnabled = true;\n          })\n        .catch(\n          function (reason) {\n            console.log(\"Situation Feedback not supported error: \", reason);\n          });\n    }\n\n    $scope.tabs.push('JSON');\n    $scope.getAlarmString = () => {\n      return JSON.stringify($scope.alarm, undefined, 2);\n    }\n\n    // Raw global details link\n    $scope.detailsLink = $scope.alarm.detailsPage.substring(0, $scope.alarm.detailsPage.indexOf(\"=\"));\n  }\n\n  detailFeedbackIncorrectButton(reductionKey) {\n    let button = this.INCORRECT_OUTLINED;\n    if (this.$scope.situationFeedback) {\n      for (let feedback of this.$scope.situationFeedback) {\n        if (feedback.alarmKey === reductionKey && feedback.feedbackType === Model.FeedbackTypes.FALSE_POSITIVE) {\n          button = this.INCORRECT_FILLED;\n          break;\n        }\n      }\n    }\n    return button;\n  }\n\n  detailFeedbackOkayButton(reductionKey) {\n    let button = this.CORRECT_FILLED;\n    if (this.$scope.situationFeedback) {\n      for (let feedback of this.$scope.situationFeedback) {\n        if (feedback.alarmKey === reductionKey && feedback.feedbackType === Model.FeedbackTypes.FALSE_POSITIVE) {\n          button = this.CORRECT_OUTLINED;\n          break;\n        }\n      }\n    }\n    return button;\n  }\n\n  initalizeFeeback() {\n    this.$scope.feedbackCorrectCount = 0;\n    this.$scope.feedbackIncorrectCount = 0;\n    let feedback = [];\n    for (let alarm of this.$scope.alarm.relatedAlarms) {\n      let alarmFeedback = new Model.OnmsSituationFeedback();\n      alarmFeedback.situationKey = this.$scope.alarm.reductionKey;\n      alarmFeedback.situationFingerprint = this.fingerPrint(this.$scope.alarm);\n      alarmFeedback.alarmKey = alarm.reductionKey;\n      alarmFeedback.feedbackType = Model.FeedbackTypes.CORRECT;\n      alarmFeedback.reason = \"ALL_CORRECT\";\n      alarmFeedback.user = this.contextSrv.user.login;\n      feedback.push(alarmFeedback);\n      this.$scope.feedbackCorrectCount++;\n    }\n    return feedback;\n  }\n\n  markIncorrect(reductionKey) {\n    for (let feedback of this.$scope.situationFeedback) {\n      if (feedback.alarmKey === reductionKey && feedback.feedbackType === Model.FeedbackTypes.CORRECT) {\n        feedback.feedbackType = Model.FeedbackTypes.FALSE_POSITIVE;\n        this.$scope.feedbackCorrectCount--;\n        this.$scope.feedbackIncorrectCount++;\n        break;\n      }\n    }\n  }\n\n  markCorrect(reductionKey) {\n    for (let feedback of this.$scope.situationFeedback) {\n      if (feedback.alarmKey === reductionKey && feedback.feedbackType === Model.FeedbackTypes.FALSE_POSITIVE) {\n        feedback.feedbackType = Model.FeedbackTypes.CORRECT;\n        this.$scope.feedbackCorrectCount++;\n        this.$scope.feedbackIncorrectCount--;\n        break;\n      }\n    }\n  }\n\n  submitEditedFeedback(form) {\n    for (let feedback of this.$scope.situationFeedback) {\n      if (form) {\n        feedback.reason = form.reason;\n      }\n    }\n    this.submitFeedback(this.$scope.situationFeedback);\n  }\n\n  submitFeedback(feedback) {\n    let self = this;\n    this.getDatasource().then(ds => { return ds.submitSituationFeedback(self.$scope.alarm.id, feedback) })\n      .then(\n        function (response) {\n          self.$scope.editFeedback = false;\n          self.$scope.submittedFeedback = true;\n          self.$scope.hasSituationFeedback = true;\n        })\n      .catch(\n        function (reason) {\n          console.log(\"Got POST error: \", reason);\n          self.$scope.editFeedback = false;\n        });\n  }\n\n  updateFeedback(feedback) {\n    for (let fb of feedback) {\n      for (let ifb of this.$scope.situationFeedback) {\n        if (fb.alarmKey === ifb.alarmKey)\n          ifb = fb;\n      }\n    }\n  }\n\n  editSituationFeedback() {\n    this.$scope.editFeedback = true;\n    this.$scope.submittedFeedback = false;\n  }\n\n  situationFeedbackButton() {\n    let button = this.CORRECT_OUTLINED;\n    let fingerprint = this.fingerPrint(this.$scope.alarm);\n    if (this.$scope.situationFeedback) {\n      for (let feedback of this.$scope.situationFeedback) {\n        if (feedback.situationFingerprint == fingerprint && this.$scope.hasSituationFeedback) {\n          button = this.CORRECT_FILLED;\n          break;\n        }\n      }\n    }\n    return button;\n  }\n\n  cancelEditedFeedback() {\n    this.$scope.situationFeedback = this.initalizeFeeback();\n    this.$scope.editFeedback = false;\n    this.$scope.submittedFeedback = false;\n  }\n\n  fingerPrint(situation) {\n    return btoa(md5(situation.relatedAlarms));\n  }\n\n  getDatasource() {\n    return this.datasourceSrv.get(this.$scope.source).then(ds => {\n      if (ds.type && ds.type.indexOf(\"fault-datasource\") < 0) {\n        throw { message: 'Only OpenNMS datasources are supported' };\n      } else {\n        return ds;\n      }\n    });\n  };\n}\n\n/** @ngInject */\nexport function alarmDetailsAsDirective() {\n  'use strict';\n  return {\n    restrict: 'E',\n    templateUrl: 'public/plugins/opennms-helm-app/panels/alarm-table/alarm_details.html',\n    controller: AlarmDetailsCtrl,\n    bindToController: true,\n    controllerAs: 'ctrl',\n    scope: { dismiss: \"&\" }\n  };\n}\n"]}