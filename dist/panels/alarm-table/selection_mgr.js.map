{"version":3,"sources":["../../../src/panels/alarm-table/selection_mgr.js"],"names":["_","SelectionMgr","getRowsInRange","onSelectionChangeCallback","clearSelectedRows","_selectedRows","Set","_lastSelectedRow","undefined","row","exclusiveModifier","rangeModifier","selectedRows","size","isEqual","handleSelection","selectedRow","Array","from","add","filter","r","alarmId","selectionRows","didSelectionChange","rowsToAddToSelection","isRowSelected","selectionRow","rowsToRemoveFromSelection","getSelectedRows","findIndex","length","each","addRowToSelection","rowToAddToSelection","selected","removeRowFromSelection"],"mappings":"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","file":"selection_mgr.js","sourcesContent":["import _ from 'lodash';\n\nexport class SelectionMgr {\n\n  constructor(getRowsInRange, onSelectionChangeCallback) {\n    this.clearSelectedRows();\n    this.getRowsInRange = getRowsInRange;\n    this.onSelectionChangeCallback = onSelectionChangeCallback;\n  }\n\n  clearSelectedRows() {\n    this._selectedRows = new Set();\n    this._lastSelectedRow = undefined;\n  }\n\n  handleRowClick(row, exclusiveModifier, rangeModifier) {\n    let selectedRows;\n    if (!rangeModifier && !exclusiveModifier && this._selectedRows.size === 1 && this._lastSelectedRow && _.isEqual(this._lastSelectedRow, row)) {\n      selectedRows = new Set();\n    } else if (!rangeModifier || this._lastSelectedRow === undefined) {\n      // No other row was previously selected, use the row that was clicked on\n      selectedRows = [row];\n    } else {\n      // Build the list of rows between the last row that was clicked\n      // and the current row\n      selectedRows = this.getRowsInRange(this._lastSelectedRow, row);\n    }\n    this.handleSelection(selectedRows, exclusiveModifier);\n  }\n\n  isRowSelected(row) {\n    for (let selectedRow of this._selectedRows) {\n      if (_.isEqual(selectedRow, row)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  getSelectedRows() {\n    return Array.from(this._selectedRows);\n  }\n\n  addRowToSelection(row) {\n    this._selectedRows.add(row);\n    this._lastSelectedRow = row;\n  }\n\n  removeRowFromSelection(row) {\n    this._selectedRows = new Set(Array.from(this._selectedRows).filter((r) => r.alarmId !== row.alarmId ));\n    this._lastSelectedRow = this._selectedRows[0];\n  }\n\n  handleSelection(selectionRows, exclusiveModifier) {\n    let didSelectionChange = false;\n    if (!exclusiveModifier) {\n      // Determine the rows we need to add to the selection\n      let rowsToAddToSelection = _.filter(selectionRows, selectionRow => !this.isRowSelected(selectionRow));\n\n      // Determine the rows we need to remove from the selection\n      let rowsToRemoveFromSelection = _.filter(this.getSelectedRows(), selectedRow => {\n        return _.findIndex(selectionRows, selectionRow => _.isEqual(selectedRow, selectionRow)) < 0;\n      });\n\n      if (rowsToRemoveFromSelection.length > 0) {\n        // Clear everything and add all the selected rows\n        this.clearSelectedRows();\n        _.each(selectionRows, selectionRow => this.addRowToSelection(selectionRow));\n        didSelectionChange = true;\n      } else if (rowsToAddToSelection.length > 0) {\n        // Add the selected rows\n        _.each(rowsToAddToSelection, rowToAddToSelection =>  this.addRowToSelection(rowToAddToSelection));\n        didSelectionChange = true;\n      }\n    } else {\n      const selected = this.isRowSelected(selectionRows[selectionRows.length - 1]);\n      // Add the rows to the current selection\n      _.each(selectionRows, selectionRow => {\n        if (selected) {\n          this.removeRowFromSelection(selectionRow);\n          didSelectionChange = true;\n        } else {\n          this.addRowToSelection(selectionRow);\n          didSelectionChange = true;\n        }\n      });\n    }\n\n    if (didSelectionChange && this.onSelectionChangeCallback) {\n      this.onSelectionChangeCallback();\n    }\n  }\n}\n"]}