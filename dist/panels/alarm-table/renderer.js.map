{"version":3,"sources":["../../../src/panels/alarm-table/renderer.js"],"names":["_","moment","kbn","Model","defineLocale","parentLocale","relativeTime","future","past","s","ss","m","mm","h","hh","d","dd","M","MM","y","yy","TableRenderer","panel","table","isUtc","sanitize","selectionMgr","initColumns","formatters","colorState","colIndex","columns","length","column","title","text","i","styles","style","regex","stringToJsRegex","pattern","match","alias","replace","createColumnFormatter","v","undefined","isArray","join","escape","defaultCellFormatter","type","date","utc","dateFormat","fromNow","dur","duration","diff","locale","humanize","format","valueFormatter","valueFormats","unit","isString","colorMode","getColorForValue","decimals","displayAs","Severities","toDisplayString","icon","getIconForSeverity","toLowerCase","checked","value","columnIndex","addWidthHack","columnClasses","formatColumnValue","classes","concat","cell","widthHack","hidden","center","push","width","clip","stylesAsString","Object","keys","reduce","map","val","key","memo","classesAsString","row","isRowSelected","source","meta","alarmId","alarm","id","page","pageSize","startPos","endPos","Math","min","rows","html","prevRow","nextRow","cellHtml","rowStyle","rowClasses","severity","label","col","renderCell","rowClass","new_row","thresholds","colors","first"],"mappings":";;;;;;;;;;;;;;;AAAOA,O;;AACAC,Y;;AACAC,S;;AAECC,W,YAAAA,K;;;;;;;;;;;;;;;;;;;;;AAERF,aAAOG,YAAP,CAAoB,UAApB,EAAgC;AAC9BC,sBAAc,IADgB;AAE9BC,sBAAc;AACZC,kBAAQ,KADI;AAEZC,gBAAQ,IAFI;AAGZC,aAAK,IAHO;AAIZC,cAAK,KAJO;AAKZC,aAAI,IALQ;AAMZC,cAAI,KANQ;AAOZC,aAAI,IAPQ;AAQZC,cAAI,KARQ;AASZC,aAAI,IATQ;AAUZC,cAAI,KAVQ;AAWZC,aAAI,IAXQ;AAYZC,cAAI,KAZQ;AAaZC,aAAI,IAbQ;AAcZC,cAAI;AAdQ;AAFgB,OAAhC;;+BAoBaC,a;AAEX,+BAAYC,KAAZ,EAAmBC,KAAnB,EAA0BC,KAA1B,EAAiCC,QAAjC,EAA2CC,YAA3C,EAAyD;AAAA;;AACvD,eAAKJ,KAAL,GAAaA,KAAb;AACA,eAAKC,KAAL,GAAaA,KAAb;AACA,eAAKC,KAAL,GAAaA,KAAb;AACA,eAAKC,QAAL,GAAgBA,QAAhB;AACA,eAAKC,YAAL,GAAoBA,YAApB;;AAEA,eAAKC,WAAL;AACD;;;;mCAEQJ,K,EAAO;AACd,iBAAKA,KAAL,GAAaA,KAAb;;AAEA,iBAAKI,WAAL;AACD;;;wCAEa;AACZ,iBAAKC,UAAL,GAAkB,EAAlB;AACA,iBAAKC,UAAL,GAAkB,EAAlB;;AAEA,iBAAK,IAAIC,WAAW,CAApB,EAAuBA,WAAW,KAAKP,KAAL,CAAWQ,OAAX,CAAmBC,MAArD,EAA6DF,UAA7D,EAAyE;AACvE,kBAAIG,SAAS,KAAKV,KAAL,CAAWQ,OAAX,CAAmBD,QAAnB,CAAb;AACAG,qBAAOC,KAAP,GAAeD,OAAOE,IAAtB;;AAEA,mBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,KAAKd,KAAL,CAAWe,MAAX,CAAkBL,MAAtC,EAA8CI,GAA9C,EAAmD;AACjD,oBAAIE,QAAQ,KAAKhB,KAAL,CAAWe,MAAX,CAAkBD,CAAlB,CAAZ;;AAEA,oBAAIG,QAAQrC,IAAIsC,eAAJ,CAAoBF,MAAMG,OAA1B,CAAZ;AACA,oBAAIR,OAAOE,IAAP,CAAYO,KAAZ,CAAkBH,KAAlB,CAAJ,EAA8B;AAC5BN,yBAAOK,KAAP,GAAeA,KAAf;;AAEA,sBAAIA,MAAMK,KAAV,EAAiB;AACfV,2BAAOC,KAAP,GAAeD,OAAOE,IAAP,CAAYS,OAAZ,CAAoBL,KAApB,EAA2BD,MAAMK,KAAjC,CAAf;AACD;;AAED;AACD;AACF;;AAED,mBAAKf,UAAL,CAAgBE,QAAhB,IAA4B,KAAKe,qBAAL,CAA2BZ,MAA3B,CAA5B;AACD;AACF;;;+CAeoBa,C,EAAGR,K,EAAO;AAC7B,gBAAIQ,MAAM,IAAN,IAAcA,MAAM,KAAK,CAAzB,IAA8BA,MAAMC,SAAxC,EAAmD;AACjD,qBAAO,EAAP;AACD;;AAED,gBAAI/C,EAAEgD,OAAF,CAAUF,CAAV,CAAJ,EAAkB;AAChBA,kBAAIA,EAAEG,IAAF,CAAO,IAAP,CAAJ;AACD;;AAED,gBAAIX,SAASA,MAAMb,QAAnB,EAA6B;AAC3B,qBAAO,KAAKA,QAAL,CAAcqB,CAAd,CAAP;AACD,aAFD,MAEO;AACL,qBAAO9C,EAAEkD,MAAF,CAASJ,CAAT,CAAP;AACD;AACF;;;gDAEqBb,M,EAAQ;AAAA;;AAC5B,gBAAI,CAACA,OAAOK,KAAZ,EAAmB;AACjB,qBAAO,KAAKa,oBAAZ;AACD;;AAED,gBAAIlB,OAAOK,KAAP,CAAac,IAAb,KAAsB,QAA1B,EAAoC;AAClC,qBAAO,YAAM;AACX,uBAAOL,SAAP;AACD,eAFD;AAGD;;AAED,gBAAId,OAAOK,KAAP,CAAac,IAAb,KAAsB,MAA1B,EAAkC;AAChC,qBAAO,aAAK;AACV,oBAAIN,MAAMC,SAAN,IAAmBD,MAAM,IAA7B,EAAmC;AACjC,yBAAO,GAAP;AACD;;AAED,oBAAI9C,EAAEgD,OAAF,CAAUF,CAAV,CAAJ,EAAkB;AAChBA,sBAAIA,EAAE,CAAF,CAAJ;AACD;AACD,oBAAIO,OAAOpD,OAAO6C,CAAP,CAAX;AACA,oBAAI,MAAKtB,KAAT,EAAgB;AACd6B,yBAAOA,KAAKC,GAAL,EAAP;AACD;AACD,oBAAIrB,OAAOK,KAAP,CAAaiB,UAAb,KAA4B,UAAhC,EAA4C;AAC1C,yBAAOF,KAAKG,OAAL,EAAP;AACD,iBAFD,MAEO,IAAIvB,OAAOK,KAAP,CAAaiB,UAAb,KAA4B,gBAAhC,EAAkD;AACvD,sBAAME,MAAMxD,OAAOyD,QAAP,CAAgBzD,SAAS0D,IAAT,CAAcN,IAAd,CAAhB,CAAZ;AACA,yBAAOI,IAAIG,MAAJ,CAAW,UAAX,EAAuBC,QAAvB,EAAP;AACD,iBAHM,MAGA;AACL,yBAAOR,KAAKS,MAAL,CAAY7B,OAAOK,KAAP,CAAaiB,UAAzB,CAAP;AACD;AACF,eApBD;AAqBD;;AAED,gBAAItB,OAAOK,KAAP,CAAac,IAAb,KAAsB,QAA1B,EAAoC;AAClC,kBAAIW,iBAAiB7D,IAAI8D,YAAJ,CAAiB/B,OAAOgC,IAAP,IAAehC,OAAOK,KAAP,CAAa2B,IAA7C,CAArB;;AAEA,qBAAO,aAAK;AACV,oBAAInB,MAAM,IAAN,IAAcA,MAAM,KAAK,CAA7B,EAAgC;AAC9B,yBAAO,GAAP;AACD;;AAED,oBAAI9C,EAAEkE,QAAF,CAAWpB,CAAX,CAAJ,EAAmB;AACjB,yBAAO,MAAKK,oBAAL,CAA0BL,CAA1B,EAA6Bb,OAAOK,KAApC,CAAP;AACD;;AAED,oBAAIL,OAAOK,KAAP,CAAa6B,SAAjB,EAA4B;AAC1B,wBAAKtC,UAAL,CAAgBI,OAAOK,KAAP,CAAa6B,SAA7B,IAA0C9C,cAAc+C,gBAAd,CAA+BtB,CAA/B,EAAkCb,OAAOK,KAAzC,CAA1C;AACD;;AAED,uBAAOyB,eAAejB,CAAf,EAAkBb,OAAOK,KAAP,CAAa+B,QAA/B,EAAyC,IAAzC,CAAP;AACD,eAdD;AAeD;;AAED,gBAAIpC,OAAOK,KAAP,CAAac,IAAb,KAAsB,UAA1B,EAAsC;AACpC,qBAAO,aAAK;AACV,oBAAIN,MAAM,IAAN,IAAcA,MAAM,KAAK,CAA7B,EAAgC;AAC9B,yBAAO,GAAP;AACD;;AAED,oBAAIb,OAAOK,KAAP,CAAagC,SAAb,KAA2B,OAA/B,EAAwC;AACtC,yBAAOnE,MAAMoE,UAAN,CAAiBzB,CAAjB,EAAoB0B,eAApB,EAAP;AACD,iBAFD,MAEO,IAAIvC,OAAOK,KAAP,CAAagC,SAAb,KAA2B,WAA/B,EAA4C;AACjD,yBAAOxB,CAAP;AACD,iBAFM,MAEA;AACL,sBAAI2B,OAAOpD,cAAcqD,kBAAd,CAAiC5B,EAAE6B,WAAF,EAAjC,CAAX;AACA,2DAAuCF,IAAvC,iBAAuD3B,CAAvD;AACD;AACF,eAbD;AAcD;;AAED,gBAAIb,OAAOK,KAAP,CAAac,IAAb,KAAsB,UAA1B,EAAsC;AACpC,qBAAO,aAAK;AACV;AACA,oBAAMwB,UAAU,CAAC,KAAG9B,CAAJ,EAAOJ,KAAP,CAAa,mBAAb,MAAsC,IAAtD;;AAEA;AACA,uBAAOkC,UAAU,QAAV,GAAqB,EAA5B;AACD,eAND;AAOD;;AAED,mBAAO,UAACC,KAAD,EAAW;AAChB,qBAAO,MAAK1B,oBAAL,CAA0B0B,KAA1B,EAAiC5C,OAAOK,KAAxC,CAAP;AACD,aAFD;AAGD;;;4CAEiBR,Q,EAAU+C,K,EAAO;AACjC,mBAAO,KAAKjD,UAAL,CAAgBE,QAAhB,IAA4B,KAAKF,UAAL,CAAgBE,QAAhB,EAA0B+C,KAA1B,CAA5B,GAA+DA,KAAtE;AACD;;;qCAEUC,W,EAAaD,K,EAAOE,Y,EAAcC,a,EAAe;AAC1DH,oBAAQ,KAAKI,iBAAL,CAAuBH,WAAvB,EAAoCD,KAApC,CAAR;AACA,gBAAI5C,SAAS,KAAKV,KAAL,CAAWQ,OAAX,CAAmB+C,WAAnB,CAAb;AACA,gBAAIzC,SAAS,EAAb;AACA,gBAAI6C,UAAUjD,OAAOiD,OAAP,IAAkB,EAAhC;AACAA,sBAAUA,QAAQC,MAAR,CAAeH,aAAf,CAAV;;AAEA,gBAAI,KAAKnD,UAAL,CAAgBuD,IAApB,EAA0B;AACxB/C,qBAAO,kBAAP,IAA6B,KAAKR,UAAL,CAAgBuD,IAA7C;AACA/C,qBAAO,OAAP,IAAkB,OAAlB;AACA,mBAAKR,UAAL,CAAgBuD,IAAhB,GAAuB,IAAvB;AACD,aAJD,MAIO,IAAI,KAAKvD,UAAL,CAAgBgD,KAApB,EAA2B;AAChCxC,qBAAO,OAAP,IAAkB,KAAKR,UAAL,CAAgBgD,KAAlC;AACA,mBAAKhD,UAAL,CAAgBgD,KAAhB,GAAwB,IAAxB;AACD;;AAED;AACA;AACA;AACA,gBAAIQ,YAAY,EAAhB;AACA,gBAAIN,YAAJ,EAAkB;AAChBM,0BAAY,yCAAyCpD,OAAOC,KAAhD,GAAwD,QAApE;AACD;;AAED,gBAAI2C,UAAU9B,SAAd,EAAyB;AACvBV,qBAAO,SAAP,IAAoB,MAApB;AACAJ,qBAAOqD,MAAP,GAAgB,IAAhB;AACD,aAHD,MAGO;AACLrD,qBAAOqD,MAAP,GAAgB,KAAhB;AACD;;AAED,gBAAIrD,OAAOK,KAAP,CAAaiD,MAAjB,EAAyB;AACvBL,sBAAQM,IAAR,CAAa,aAAb;AACD;;AAED,gBAAIvD,OAAOK,KAAP,CAAamD,KAAjB,EAAwB;AACtBpD,qBAAO,OAAP,IAAkBJ,OAAOK,KAAP,CAAamD,KAA/B;AACA,kBAAIxD,OAAOK,KAAP,CAAaoD,IAAjB,EAAuB;AACrBrD,uBAAO,WAAP,IAAsBJ,OAAOK,KAAP,CAAamD,KAAnC;AACApD,uBAAO,aAAP,IAAwB,QAAxB;AACD;AACF;;AAED,gBAAIJ,OAAOK,KAAP,CAAaoD,IAAjB,EAAuB;AACrBrD,qBAAO,UAAP,IAAqB,QAArB;AACAA,qBAAO,eAAP,IAA0B,UAA1B;AACAA,qBAAO,aAAP,IAAwB,QAAxB;AACD;;AAED,gBAAIsD,iBAAiB,EAArB;AACA,gBAAIC,OAAOC,IAAP,CAAYxD,MAAZ,EAAoBL,MAApB,GAA6B,CAAjC,EAAoC;AAClC2D,+BAAiB,YAAY3F,EAAE8F,MAAF,CAAS9F,EAAE+F,GAAF,CAAM1D,MAAN,EAAc,UAAS2D,GAAT,EAAcC,GAAd,EAAkB;AAAE,uBAAOA,MAAM,GAAN,GAAYD,GAAnB;AAAyB,eAA3D,CAAT,EAC7B,UAACE,IAAD,EAAO5D,KAAP,EAAiB;AACf,oBAAI4D,KAAKlE,MAAL,GAAc,CAAlB,EAAqB;AACnB,yBAAOkE,OAAO,IAAP,GAAc5D,KAArB;AACD,iBAFD,MAEO;AACL,yBAAOA,KAAP;AACD;AACF,eAP4B,EAO1B,EAP0B,CAAZ,GAOR,GAPT;AAQD;;AAED,gBAAIL,OAAOK,KAAP,CAAac,IAAb,KAAsB,UAAtB,IAAoCnB,OAAOK,KAAP,CAAagC,SAAb,KAA2B,MAAnE,EAA2E;AACzEY,sBAAQM,IAAR,CAAa,aAAb;AACD;;AAED,gBAAIW,kBAAkB,EAAtB;AACA,gBAAIjB,QAAQlD,MAAR,GAAiB,CAArB,EAAwB;AACtBmE,gCAAkB,YAAYjB,QAAQjC,IAAR,CAAa,GAAb,CAAZ,GAAgC,GAAlD;AACD;;AAED,mBAAO,SAAS0C,cAAT,GAA0B,GAA1B,GAAgCQ,eAAhC,GAAkD,GAAlD,GAAwDtB,KAAxD,GAAgEQ,SAAhE,GAA4E,OAAnF;AACD;;;wCA8Bae,G,EAAK;AACjB,mBAAO,KAAK1E,YAAL,CAAkB2E,aAAlB,CAAgC;AACrCC,sBAAQF,IAAIG,IAAJ,CAASD,MADoB;AAErCE,uBAASJ,IAAIG,IAAJ,CAASE,KAAT,CAAeC;AAFa,aAAhC,CAAP;AAID;;;iCAEMC,I,EAAM;AACX,gBAAIC,WAAW,KAAKtF,KAAL,CAAWsF,QAAX,IAAuB,GAAtC;AACA,gBAAIC,WAAWF,OAAOC,QAAtB;AACA,gBAAIE,SAASC,KAAKC,GAAL,CAASH,WAAWD,QAApB,EAA8B,KAAKrF,KAAL,CAAW0F,IAAX,CAAgBjF,MAA9C,CAAb;AACA,gBAAIkF,OAAO,EAAX;;AAEA,iBAAK,IAAI/F,IAAI0F,QAAb,EAAuB1F,IAAI2F,MAA3B,EAAmC3F,GAAnC,EAAwC;AACtC,kBAAIiF,MAAM,KAAK7E,KAAL,CAAW0F,IAAX,CAAgB9F,CAAhB,CAAV;AACA,kBAAIgG,gBAAJ;AAAA,kBAAaC,gBAAb;AACA,kBAAIjG,IAAE,CAAF,IAAO,CAAX,EAAc;AACZgG,0BAAU,KAAK5F,KAAL,CAAW0F,IAAX,CAAgB9F,IAAE,CAAlB,CAAV;AACD;AACD,kBAAIA,IAAE,CAAF,GAAM2F,MAAV,EAAkB;AAChBM,0BAAU,KAAK7F,KAAL,CAAW0F,IAAX,CAAgB9F,IAAE,CAAlB,CAAV;AACD;;AAED,kBAAIkG,WAAW,EAAf;AACA,kBAAIC,WAAW,EAAf;AACA,kBAAIC,aAAa,EAAjB;;AAEA,kBAAIjB,SAASF,IAAIG,IAAJ,CAASD,MAAT,CAAgB1D,OAAhB,CAAwB,IAAxB,EAA8B,MAA9B,CAAb;AACA,kBAAI6D,QAAQL,IAAIG,IAAJ,CAASE,KAArB;AACA,kBAAIe,WAAWf,MAAMe,QAAN,CAAeC,KAAf,CAAqB9C,WAArB,EAAf;;AAEA,mBAAK,IAAIvC,IAAI,CAAb,EAAgBA,IAAI,KAAKb,KAAL,CAAWQ,OAAX,CAAmBC,MAAvC,EAA+CI,GAA/C,EAAoD;AAClD,oBAAI4C,gBAAgB,EAApB;AACA,oBAAM0C,MAAM,KAAKnG,KAAL,CAAWQ,OAAX,CAAmBK,CAAnB,CAAZ;AACA,oBAAI,KAAKd,KAAL,CAAWkG,QAAX,KAAwB,QAA5B,EAAsC;AACpC,sBAAIE,OAAOA,IAAIpF,KAAX,IAAoBoF,IAAIpF,KAAJ,CAAUc,IAAV,KAAmB,UAA3C,EAAuD;AACrD4B,kCAAcQ,IAAd,CAAmBgC,QAAnB;AACD;AACF;AACD,oBAAIE,OAAOA,IAAIpF,KAAX,IAAoBoF,IAAIpF,KAAJ,CAAUc,IAAV,KAAmB,UAA3C,EAAuD;AACrD4B,gCAAcQ,IAAd,CAAmB,eAAnB;AACD;AACD6B,4BAAY,KAAKM,UAAL,CAAgBvF,CAAhB,EAAmBgE,IAAIhE,CAAJ,CAAnB,EAA2BjB,MAAM0F,QAAjC,EAA2C7B,aAA3C,CAAZ;AACD;;AAED,kBAAI,KAAKnD,UAAL,CAAgBuE,GAApB,EAAyB;AACvBkB,2BAAW,8BAA8B,KAAKzF,UAAL,CAAgBuE,GAA9C,GAAoD,gBAA/D;AACA,qBAAKvE,UAAL,CAAgBuE,GAAhB,GAAsB,IAAtB;AACD;;AAED,kBAAI,KAAK9E,KAAL,CAAWkG,QAAX,KAAwB,IAAxB,IAAgC,KAAKlG,KAAL,CAAWkG,QAAX,KAAwB,KAA5D,EAAmE;AACjED,2BAAW/B,IAAX,CAAgBgC,QAAhB;AACD;;AAED,kBAAI,KAAKnB,aAAL,CAAmBD,GAAnB,CAAJ,EAA6B;AAC3BmB,2BAAW/B,IAAX,CAAgB,UAAhB;AACD;;AAED,kBAAI2B,WAAW,KAAKd,aAAL,CAAmBc,OAAnB,CAAf,EAA4C;AAC1CI,2BAAW/B,IAAX,CAAgB,eAAhB;AACD;;AAED,kBAAI4B,WAAW,KAAKf,aAAL,CAAmBe,OAAnB,CAAf,EAA4C;AAC1CG,2BAAW/B,IAAX,CAAgB,eAAhB;AACD;;AAED,kBAAIoC,WAAW,YAAYL,WAAWtE,IAAX,CAAgB,GAAhB,CAAZ,GAAmC,GAAlD;AACAiE,sBAAQ,SAASI,QAAT,GAAoBM,QAApB,8CAAsEtB,MAAtE,YAAkFG,MAAMC,EAAxF,wDAA4IJ,MAA5I,YAAwJG,MAAMC,EAA9J,YAAwKW,QAAxK,GAAmL,OAA3L;AACD;;AAED,mBAAOH,IAAP;AACD;;;0CAEe;AACd,gBAAID,OAAO,EAAX;;AAEA,iBAAK,IAAI9F,IAAI,CAAb,EAAgBA,IAAI,KAAKI,KAAL,CAAW0F,IAAX,CAAgBjF,MAApC,EAA4Cb,GAA5C,EAAiD;AAC/C,kBAAIiF,MAAM,KAAK7E,KAAL,CAAW0F,IAAX,CAAgB9F,CAAhB,CAAV;AACA,kBAAI0G,UAAU,EAAd;AACA,mBAAK,IAAIzF,IAAI,CAAb,EAAgBA,IAAI,KAAKb,KAAL,CAAWQ,OAAX,CAAmBC,MAAvC,EAA+CI,GAA/C,EAAoD;AAClDyF,wBAAQrC,IAAR,CAAa,KAAKP,iBAAL,CAAuB7C,CAAvB,EAA0BgE,IAAIhE,CAAJ,CAA1B,CAAb;AACD;AACD6E,mBAAKzB,IAAL,CAAUqC,OAAV;AACD;AACD,mBAAO;AACL9F,uBAAS,KAAKR,KAAL,CAAWQ,OADf;AAELkF,oBAAMA;AAFD,aAAP;AAID;;;2CArTuBpC,K,EAAOvC,K,EAAO;AACpC,gBAAI,CAACA,MAAMwF,UAAX,EAAuB;AACrB,qBAAO,IAAP;AACD;;AAED,iBAAK,IAAI1F,IAAIE,MAAMwF,UAAN,CAAiB9F,MAA9B,EAAsCI,IAAI,CAA1C,EAA6CA,GAA7C,EAAkD;AAChD,kBAAIyC,SAASvC,MAAMwF,UAAN,CAAiB1F,IAAI,CAArB,CAAb,EAAsC;AACpC,uBAAOE,MAAMyF,MAAN,CAAa3F,CAAb,CAAP;AACD;AACF;AACD,mBAAOpC,EAAEgI,KAAF,CAAQ1F,MAAMyF,MAAd,CAAP;AACD;;;6CAsLyBP,Q,EAAU;AAClC,gBAAI/C,OAAO,UAAX;AACA,oBAAO+C,QAAP;AACE,mBAAK,eAAL;AACE/C,uBAAO,UAAP;AACA;AACF,mBAAK,SAAL;AACEA,uBAAO,mBAAP;AACA;AACF,mBAAK,OAAL;AACEA,uBAAO,WAAP;AACA;AACF,mBAAK,OAAL;AACEA,uBAAO,WAAP;AACA;AACF,mBAAK,UAAL;AACEA,uBAAO,aAAP;AACA;AACF,mBAAK,QAAL;AACEA,uBAAO,UAAP;AACA;AACF,mBAAK,SAAL;AACEA,uBAAO,uBAAP;AACA;AArBJ;AAuBA,mBAAOA,IAAP;AACD","file":"renderer.js","sourcesContent":["import _ from 'lodash';\nimport moment from 'moment';\nimport kbn from 'app/core/utils/kbn';\n\nimport {Model} from '../../opennms';\n\nmoment.defineLocale('en-short', {\n  parentLocale: 'en',\n  relativeTime: {\n    future: \"+%s\",\n    past:   \"%s\",\n    s  : \"1s\",\n    ss : \"%ds\",\n    m:  \"1m\",\n    mm: \"%dm\",\n    h:  \"1h\",\n    hh: \"%dh\",\n    d:  \"1d\",\n    dd: \"%dd\",\n    M:  \"1m\",\n    MM: \"%dm\",\n    y:  \"1y\",\n    yy: \"%dy\"\n  }\n});\n\nexport class TableRenderer {\n\n  constructor(panel, table, isUtc, sanitize, selectionMgr) {\n    this.panel = panel;\n    this.table = table;\n    this.isUtc = isUtc;\n    this.sanitize = sanitize;\n    this.selectionMgr = selectionMgr;\n\n    this.initColumns();\n  }\n\n  setTable(table) {\n    this.table = table;\n\n    this.initColumns();\n  }\n\n  initColumns() {\n    this.formatters = [];\n    this.colorState = {};\n\n    for (let colIndex = 0; colIndex < this.table.columns.length; colIndex++) {\n      let column = this.table.columns[colIndex];\n      column.title = column.text;\n\n      for (let i = 0; i < this.panel.styles.length; i++) {\n        let style = this.panel.styles[i];\n\n        let regex = kbn.stringToJsRegex(style.pattern);\n        if (column.text.match(regex)) {\n          column.style = style;\n\n          if (style.alias) {\n            column.title = column.text.replace(regex, style.alias);\n          }\n\n          break;\n        }\n      }\n\n      this.formatters[colIndex] = this.createColumnFormatter(column);\n    }\n  }\n\n  static getColorForValue(value, style) {\n    if (!style.thresholds) {\n      return null;\n    }\n\n    for (let i = style.thresholds.length; i > 0; i--) {\n      if (value >= style.thresholds[i - 1]) {\n        return style.colors[i];\n      }\n    }\n    return _.first(style.colors);\n  }\n\n  defaultCellFormatter(v, style) {\n    if (v === null || v === void 0 || v === undefined) {\n      return '';\n    }\n\n    if (_.isArray(v)) {\n      v = v.join(', ');\n    }\n\n    if (style && style.sanitize) {\n      return this.sanitize(v);\n    } else {\n      return _.escape(v);\n    }\n  }\n\n  createColumnFormatter(column) {\n    if (!column.style) {\n      return this.defaultCellFormatter;\n    }\n\n    if (column.style.type === 'hidden') {\n      return () => {\n        return undefined;\n      };\n    }\n\n    if (column.style.type === 'date') {\n      return v => {\n        if (v === undefined || v === null) {\n          return '-';\n        }\n\n        if (_.isArray(v)) {\n          v = v[0];\n        }\n        let date = moment(v);\n        if (this.isUtc) {\n          date = date.utc();\n        }\n        if (column.style.dateFormat === 'relative') {\n          return date.fromNow();\n        } else if (column.style.dateFormat === 'relative-short') {\n          const dur = moment.duration(moment().diff(date));\n          return dur.locale('en-short').humanize();\n        } else {\n          return date.format(column.style.dateFormat);\n        }\n      };\n    }\n\n    if (column.style.type === 'number') {\n      let valueFormatter = kbn.valueFormats[column.unit || column.style.unit];\n\n      return v => {\n        if (v === null || v === void 0) {\n          return '-';\n        }\n\n        if (_.isString(v)) {\n          return this.defaultCellFormatter(v, column.style);\n        }\n\n        if (column.style.colorMode) {\n          this.colorState[column.style.colorMode] = TableRenderer.getColorForValue(v, column.style);\n        }\n\n        return valueFormatter(v, column.style.decimals, null);\n      };\n    }\n\n    if (column.style.type === 'severity') {\n      return v => {\n        if (v === null || v === void 0) {\n          return '-';\n        }\n\n        if (column.style.displayAs === 'label') {\n          return Model.Severities[v].toDisplayString();\n        } else if (column.style.displayAs === 'labelCaps') {\n          return v;\n        } else {\n          var icon = TableRenderer.getIconForSeverity(v.toLowerCase());\n          return `<i class=\"icon severity-icon ${icon}\" title=\"${v}\"></i>`;\n        }\n      };\n    }\n\n    if (column.style.type === 'checkbox') {\n      return v => {\n        // coerce the value into a boolean\n        const checked = (''+v).match(/^(true|t|y|yes)$/i) !== null;\n\n        // then turn the value to an icon\n        return checked ? '\\u2713' : '';\n      };\n    }\n\n    return (value) => {\n      return this.defaultCellFormatter(value, column.style);\n    };\n  }\n\n  formatColumnValue(colIndex, value) {\n    return this.formatters[colIndex] ? this.formatters[colIndex](value) : value;\n  }\n\n  renderCell(columnIndex, value, addWidthHack, columnClasses) {\n    value = this.formatColumnValue(columnIndex, value);\n    let column = this.table.columns[columnIndex];\n    let styles = {};\n    let classes = column.classes || [];\n    classes = classes.concat(columnClasses);\n\n    if (this.colorState.cell) {\n      styles['background-color'] = this.colorState.cell;\n      styles['color'] = 'white';\n      this.colorState.cell = null;\n    } else if (this.colorState.value) {\n      styles['color'] = this.colorState.value;\n      this.colorState.value = null;\n    }\n\n    // because of the fixed table headers css only solution\n    // there is an issue if header cell is wider the cell\n    // this hack adds header content to cell (not visible)\n    let widthHack = '';\n    if (addWidthHack) {\n      widthHack = '<div class=\"table-panel-width-hack\">' + column.title + '</div>';\n    }\n\n    if (value === undefined) {\n      styles['display'] = 'none';\n      column.hidden = true;\n    } else {\n      column.hidden = false;\n    }\n\n    if (column.style.center) {\n      classes.push('text-center');\n    }\n\n    if (column.style.width) {\n      styles['width'] = column.style.width;\n      if (column.style.clip) {\n        styles['max-width'] = column.style.width;\n        styles['white-space'] = 'nowrap';\n      }\n    }\n\n    if (column.style.clip) {\n      styles['overflow'] = 'hidden';\n      styles['text-overflow'] = 'ellipsis';\n      styles['white-space'] = 'nowrap';\n    }\n\n    let stylesAsString = '';\n    if (Object.keys(styles).length > 0) {\n      stylesAsString = 'style=\"' + _.reduce(_.map(styles, function(val, key){ return key + ':' + val; }),\n      (memo, style) => {\n        if (memo.length > 0) {\n          return memo + '; ' + style;\n        } else {\n          return style;\n        }\n      }, '') + '\"';\n    }\n\n    if (column.style.type === 'severity' && column.style.displayAs === 'icon') {\n      classes.push('text-center');\n    }\n\n    let classesAsString = '';\n    if (classes.length > 0) {\n      classesAsString = 'class=\"' + classes.join(' ') + '\"';\n    }\n\n    return '<td ' + stylesAsString + ' ' + classesAsString + '>' + value + widthHack + '</td>';\n  }\n\n  static getIconForSeverity(severity) {\n    let icon = 'ion-help';\n    switch(severity) {\n      case 'indeterminate':\n        icon = 'ion-help';\n        break;\n      case 'warning':\n        icon = 'ion-alert-circled';\n        break;\n      case 'minor':\n        icon = 'ion-flash';\n        break;\n      case 'major':\n        icon = 'ion-flame';\n        break;\n      case 'critical':\n        icon = 'ion-nuclear';\n        break;\n      case 'normal':\n        icon = 'ion-leaf';\n        break;\n      case 'cleared':\n        icon = 'ion-checkmark-circled';\n        break;\n    }\n    return icon;\n  }\n\n  isRowSelected(row) {\n    return this.selectionMgr.isRowSelected({\n      source: row.meta.source,\n      alarmId: row.meta.alarm.id\n    });\n  }\n\n  render(page) {\n    let pageSize = this.panel.pageSize || 100;\n    let startPos = page * pageSize;\n    let endPos = Math.min(startPos + pageSize, this.table.rows.length);\n    let html = \"\";\n\n    for (let y = startPos; y < endPos; y++) {\n      let row = this.table.rows[y];\n      let prevRow, nextRow;\n      if (y-1 >= 0) {\n        prevRow = this.table.rows[y-1];\n      }\n      if (y+1 < endPos) {\n        nextRow = this.table.rows[y+1];\n      }\n\n      let cellHtml = '';\n      let rowStyle = '';\n      let rowClasses = [];\n\n      let source = row.meta.source.replace(/'/g, '\\\\\\'');\n      let alarm = row.meta.alarm;\n      let severity = alarm.severity.label.toLowerCase();\n\n      for (let i = 0; i < this.table.columns.length; i++) {\n        let columnClasses = [];\n        const col = this.table.columns[i];\n        if (this.panel.severity === 'column') {\n          if (col && col.style && col.style.type === 'severity') {\n            columnClasses.push(severity);\n          }\n        }\n        if (col && col.style && col.style.type === 'checkbox') {\n          columnClasses.push('onms-checkbox');\n        }\n        cellHtml += this.renderCell(i, row[i], y === startPos, columnClasses);\n      }\n\n      if (this.colorState.row) {\n        rowStyle = ' style=\"background-color:' + this.colorState.row + ';color: white\"';\n        this.colorState.row = null;\n      }\n\n      if (this.panel.severity === true || this.panel.severity === 'row') {\n        rowClasses.push(severity);\n      }\n\n      if (this.isRowSelected(row)) {\n        rowClasses.push(\"selected\");\n      }\n\n      if (prevRow && this.isRowSelected(prevRow)) {\n        rowClasses.push(\"prev-selected\");\n      }\n\n      if (nextRow && this.isRowSelected(nextRow)) {\n        rowClasses.push(\"next-selected\");\n      }\n\n      let rowClass = 'class=\"' + rowClasses.join(' ') + '\"';\n      html += '<tr ' + rowStyle + rowClass + ` ng-click=\"ctrl.onRowClick($event, '${source}', ${alarm.id})\"  context-menu=\"ctrl.getContextMenu($event, '${source}', ${alarm.id})\">` + cellHtml + '</tr>';\n    }\n\n    return html;\n  }\n\n  render_values() {\n    let rows = [];\n\n    for (let y = 0; y < this.table.rows.length; y++) {\n      let row = this.table.rows[y];\n      let new_row = [];\n      for (let i = 0; i < this.table.columns.length; i++) {\n        new_row.push(this.formatColumnValue(i, row[i]));\n      }\n      rows.push(new_row);\n    }\n    return {\n      columns: this.table.columns,\n      rows: rows,\n    };\n  }\n}\n"]}