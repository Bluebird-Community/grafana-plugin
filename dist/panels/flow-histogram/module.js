define(["@grafana/data","react","moment","@grafana/ui"],((e,t,n,a)=>(()=>{"use strict";var o={305:t=>{t.exports=e},388:e=>{e.exports=a},283:e=>{e.exports=n},650:e=>{e.exports=t}},l={};function i(e){var t=l[e];if(void 0!==t)return t.exports;var n=l[e]={exports:{}};return o[e](n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{i.r(r),i.d(r,{plugin:()=>k});var e=i(305),t=i(650),n=i.n(t),a=i(283),o=i.n(a);const l=(e,t,n,a,o,l)=>{const i=o?a.divisor*l:a.divisor;return t.map((t=>{const a=t[h.indexLabel.index],o=e[a]/i;return n?[o,a]:[a,o]}))},s=(e,t)=>{let n=e.find((e=>e.name===t));return n&&n.values?n.values.toArray():[]},d=e=>{if(!e||!e[0].meta||!e[0].meta.custom)throw 0===e.length?new Error("No data, check the datasource is flow-datasource and function asSummaryTable are selected"):new Error("Incorrect or incomplete data, check the datasource is flow-datasource and function asSummaryTable are selected");return!0},c=(e,t,n,a)=>{const o="Under Graph"===a.flowHistogramOptions.position.label,l=a.flowHistogramOptions.showLegend;switch(e){case u.Container:return{display:l&&o?"block":"inline-block",float:l&&o?"none":"left"};case u.Legend:const e="Horizontal"===a.flowHistogramOptions.direction.label?0:25;return{display:l?o?"block":"inline-block":"none",width:o?n:.2*n-e,height:o?a.flowHistogramOptions.height:t,float:o?"none":"left"};case u.ContainerGraph:return{width:!l||o?n:.8*n,height:t-25-(l&&o?a.flowHistogramOptions.height:0)};case u.GraphAxisLabel:return{height:25,display:"flex",justifyContent:"center",alignItems:"center"};case u.GraphAxisLabelUnit:return{marginTop:24}}};var u;!function(e){e[e.Container=0]="Container",e[e.ContainerGraph=1]="ContainerGraph",e[e.GraphAxisLabel=2]="GraphAxisLabel",e[e.GraphAxisLabelUnit=3]="GraphAxisLabelUnit",e[e.Legend=4]="Legend"}(u||(u={}));const p=[{label:"Horizontal",value:"0"},{label:"Vertical",value:"1"}],m=[{label:"B",value:"0"},{label:"KB",value:"1"},{label:"MB",value:"2"},{label:"GB",value:"3"}],g=[{label:"Total",value:"0"},{label:"Rate",value:"1"}],b=[{label:"Separate",value:"0"},{label:"Stacked",value:"1"}],f=[{label:"Right Side",value:""},{label:"Under Graph",value:""}],v=(e,t)=>{var n,a,o;let l=1,i="Bytes";if(!d(t))return{units:i,divisor:l};const r=!!(null==t||null===(n=t[0])||void 0===n||null===(a=n.meta)||void 0===a||null===(o=a.custom)||void 0===o?void 0:o.toBits),s="Rate"===e.flowHistogramOptions.display.label;switch(e.flowHistogramOptions.units.label){case"B":i=r?"Bits":"Bytes";break;case"KB":l=1024,i=r?"Kb":"KB";break;case"MB":l=Math.pow(1024,2),i=r?"Mb":"MB";break;case"GB":l=Math.pow(1024,3),i=r?"Gb":"GB"}return s&&(i+="/s"),{units:i,divisor:l}},h={horizontal:{value:0,index:0,metric:1},vertical:{value:1,index:1,metric:0},indexLabel:{index:0,label:1}},w={dataIn:{label:"In",value:0},dataOut:{label:"Out",value:1}};var O=i(388);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const H=e=>{var t,a,{children:o}=e,l=function(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,["children"]);return n().createElement(n().Fragment,null,n().createElement("style",null,"\n                        .onms-inline-field > label{\n                            width:160px;\n                        }\n                    "),n().createElement(O.InlineField,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){y(e,t,n[t])}))}return e}({},l),a=null!=(a={className:"onms-inline-field"})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n.push.apply(n,a)}return n}(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})),t),o))},x=({className:e,children:t})=>n().createElement("div",{className:e,style:{display:"flex",alignItems:"center",height:32,width:32}},t);function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const L=({onChange:e,context:a})=>{var o,l,i,r,s,d,c,u,v,h,w,y,L,k;const[S,B]=(0,t.useState)({direction:(null===(o=a.options)||void 0===o||null===(l=o.flowHistogramOptions)||void 0===l?void 0:l.direction)||p[0],units:(null===(i=a.options)||void 0===i||null===(r=i.flowHistogramOptions)||void 0===r?void 0:r.units)||m[0],display:(null===(s=a.options)||void 0===s||null===(d=s.flowHistogramOptions)||void 0===d?void 0:d.display)||g[0],mode:(null===(c=a.options)||void 0===c||null===(u=c.flowHistogramOptions)||void 0===u?void 0:u.mode)||b[0],showLegend:(null===(v=a.options)||void 0===v||null===(h=v.flowHistogramOptions)||void 0===h?void 0:h.showLegend)||!0,position:(null===(w=a.options)||void 0===w||null===(y=w.flowHistogramOptions)||void 0===y?void 0:y.position)||f[0],height:(null===(L=a.options)||void 0===L||null===(k=L.flowHistogramOptions)||void 0===k?void 0:k.height)||42}),j=(e,t)=>{B((n=>{const a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){E(e,t,n[t])}))}return e}({},n);return a[t]=e,a}))};return(0,t.useEffect)((()=>{e(S)}),[S]),n().createElement("div",null,n().createElement("p",{style:{marginTop:12,marginBottom:3}},"General"),n().createElement(H,{label:"Direction"},n().createElement(O.Select,{options:p,value:null==S?void 0:S.direction,onChange:e=>j(e,"direction")})),n().createElement(H,{label:"Units"},n().createElement(O.Select,{options:m,value:null==S?void 0:S.units,onChange:e=>j(e,"units")})),n().createElement(H,{label:"Display"},n().createElement(O.Select,{options:g,value:null==S?void 0:S.display,onChange:e=>j(e,"display")})),n().createElement(H,{label:"Mode"},n().createElement(O.Select,{options:b,value:null==S?void 0:S.mode,onChange:e=>j(e,"mode")})),n().createElement("p",{style:{marginTop:20,marginBottom:3}},"Legend"),n().createElement(H,{label:"Show Legend"},n().createElement(x,null,n().createElement(O.Switch,{value:null==S?void 0:S.showLegend,onChange:()=>j(!(null==S?void 0:S.showLegend),"showLegend")}))),n().createElement(H,{label:"Position"},n().createElement(O.Select,{options:f,value:null==S?void 0:S.position,onChange:e=>j(e,"position")})),n().createElement(H,{label:"Height"},n().createElement(O.Input,{type:"number",max:75,min:20,value:null==S?void 0:S.height,onChange:e=>j(Number.parseInt(e.currentTarget.value,10)>0?e.currentTarget.value:0,"height")})))},k=new e.PanelPlugin((({data:e,height:a,width:i,options:r})=>{const p=(0,t.useRef)();return(0,t.useEffect)((()=>{d(null==e?void 0:e.series);const t=((e,t)=>{let n={};const a=v(t,null==e?void 0:e.series);if(!e||!e.series||1!==e.series.length)throw new Error("Only one query is permitted in this panel");{const i=e.series[0],r=i&&i.meta&&i.meta.custom?i.meta.custom.metric:void 0,d="Stacked"===t.flowHistogramOptions.mode.label,c="Horizontal"===t.flowHistogramOptions.direction.label,u="Rate"===t.flowHistogramOptions.display.label,p=!!i.meta.custom.toBits,m=p?"Bits In":"Bytes In",g=p?"Bits Out":"Bytes Out",b=s(i.fields,m),f=s(i.fields,g);let v,O=[],y=[],H=[],x=[];if(!r)return n;switch(r){case"Applications":x=s(i.fields,"Application"),v=e=>e;break;case"Hosts":x=s(i.fields,"Host"),v=e=>e;break;case"Conversations":x=s(i.fields,"Application");const e=s(i.fields,"Source"),t=s(i.fields,"Dest.");v=(n,a)=>e[a]+" <-> "+t[a]+" ["+(n||"Unknown")+"]"}const E=((e,t,n)=>e.map(((e,n)=>[n,t(e,n)])))(x,v),L=o().duration(e.timeRange.to.diff(e.timeRange.from)).asSeconds();d?H=((e,t,n,a,o,l,i)=>{const r=l?o.divisor*i:o.divisor;return e.map((e=>{const o=e[h.indexLabel.index],l=e[h.indexLabel.label],i=t[o]/r,s=n[o]/r;return a?{label:l,data:[[i,w.dataIn.value],[s,w.dataOut.value]]}:{label:l,data:[[w.dataIn.value,i],[w.dataOut.value,s]]}}))})(E,b,f,c,a,u,L):(O=l(b,E,c,a,u,L),y=l(f,E,c,a,u,L)),n={separateData:{inByLabel:O,outByLabel:y,ticks:E},stackedData:{metricsByLabel:H,ticks:[[w.dataIn.value,w.dataIn.label],[w.dataOut.value,w.dataOut.label]]}}}return n})(e,r),n=((e,t)=>{switch(t.flowHistogramOptions.mode.label){case"Separate":{var n,a;let o={label:"In",bars:{show:!0,barWidth:.2,align:"Horizontal"===t.flowHistogramOptions.direction.label?"left":"right"},data:null===(n=e.separateData)||void 0===n?void 0:n.inByLabel};return[{label:"Out",bars:{show:!0,barWidth:.2,align:"Horizontal"===t.flowHistogramOptions.direction.label?"right":"left"},data:null===(a=e.separateData)||void 0===a?void 0:a.outByLabel},o]}case"Stacked":var o;return(null===(o=e.stackedData)||void 0===o?void 0:o.metricsByLabel)?e.stackedData.metricsByLabel:[];default:return[]}})(t,r),a=((e,t)=>{var n,a;const o="Stacked"===t.flowHistogramOptions.mode.label,l="Horizontal"===t.flowHistogramOptions.direction.label,i="Under Graph"===t.flowHistogramOptions.position.label?5:1,r=t.flowHistogramOptions.showLegend,s=t.flowHistogramOptions.position.value,d={mode:"categories",tickLength:0,ticks:o?null===(n=e.stackedData)||void 0===n?void 0:n.ticks:null===(a=e.separateData)||void 0===a?void 0:a.ticks,autoscaleMargin:.02};return{legend:{show:r,container:null,position:s,backgroundOpacity:0,noColumns:i,labelFormatter:(e,t)=>'<a style="margin:3px" >'+e+"</a>"},series:{bars:{align:"center",barWidth:.6,fill:.8,horizontal:l,lineWidth:1,show:!0},stack:o},grid:{borderWidth:0},xaxis:l?{}:d,yaxis:l?d:{}}})(t,r);$.plot(p.current,n,a),(e=>{if(e.flowHistogramOptions.showLegend){const t="Under Graph"===e.flowHistogramOptions.position.label?".flow-histogram-legend-bottom":".flow-histogram-legend-right",n=$(".legend");n&&n.html()&&($(t).html(""),$(t).append(n.html()),n.remove())}})(r)}),[e,i,a,p,r]),n().createElement(n().Fragment,null,n().createElement("style",null,`\n                   .side-spot {\n                        margin-left: 25px;\n                        position: relative;\n                    }                                     \n                    .side-spot .side-spot-label {\n                        transform: rotate(-90deg) translateY(-50%);\n                        transform-origin: center;\n                        top: 42%;\n                        position: absolute;\n                        width: 0;\n                    }\n                    .legendColorBox {\n                        padding-right: 3px;\n                    }\n                    .legendLabel {\n                        color: rgb(204, 204, 220);\n                    }\n                    .side-spot table {\n                        height: ${r.flowHistogramOptions.height}px;\n                    }\n                    .flow-histogram-legend-right table {\n                        margin: 0 auto;\n                    }\n                `),n().createElement("div",null,n().createElement("div",{className:"Horizontal"===r.flowHistogramOptions.direction.label?"":"side-spot",style:c(u.Container,a,i,r)},n().createElement("div",{ref:p,style:c(u.ContainerGraph,a,i,r)}),n().createElement("div",{className:"side-spot-label",style:c(u.GraphAxisLabel,a,i,r)},n().createElement("p",{style:c(u.GraphAxisLabelUnit,a,i,r)},v(r,null==e?void 0:e.series).units))),n().createElement("div",{className:"Under Graph"===r.flowHistogramOptions.position.label?"flow-histogram-legend-bottom":"flow-histogram-legend-right",style:c(u.Legend,a,i,r)})))})).setPanelOptions((e=>{e.addCustomEditor({id:"flow-histogram-options",path:"flowHistogramOptions",name:"Flow Histogram Panel",editor:L})}))})(),r})()));
//# sourceMappingURL=module.js.map