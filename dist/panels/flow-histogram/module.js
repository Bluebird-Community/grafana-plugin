define(["lodash","app/plugins/sdk","jquery","moment","jquery.flot","jquery.flot.selection","jquery.flot.crosshair","jquery.flot.time","jquery.flot.stack"],function(t,e,i,o,n,s,a,r,l){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=55)}([function(e,i){e.exports=t},,function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}t.exports=function(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}},function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(e)}t.exports=i},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,i){var o=i(10),n=i(5);t.exports=function(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?n(t):e}},function(t,e,i){var o=i(11);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}},function(t,i){t.exports=e},function(t,e){t.exports=i},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(e){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?t.exports=o=function(t){return i(t)}:t.exports=o=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)},o(e)}t.exports=o},function(t,e){function i(e,o){return t.exports=i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(e,o)}t.exports=i},,,function(t,e){t.exports=o},,,,,,,,,,,,,,,,function(t,e){t.exports=n},function(t,e){t.exports=s},function(t,e){t.exports=a},function(t,e){!function(t){function e(t,e,i,o){var n="categories"==e.xaxis.options.mode,s="categories"==e.yaxis.options.mode;if(n||s){var a=o.format;if(!a){var r=e;if((a=[]).push({x:!0,number:!0,required:!0}),a.push({y:!0,number:!0,required:!0}),r.bars.show||r.lines.show&&r.lines.fill){var l=!!(r.bars.show&&r.bars.zero||r.lines.show&&r.lines.zero);a.push({y:!0,number:!0,required:!1,defaultValue:0,autoscale:l}),r.bars.horizontal&&(delete a[a.length-1].y,a[a.length-1].x=!0)}o.format=a}for(var h=0;h<a.length;++h)a[h].x&&n&&(a[h].number=!1),a[h].y&&s&&(a[h].number=!1)}}function i(t){var e=[];for(var i in t.categories){var o=t.categories[i];o>=t.min&&o<=t.max&&e.push([o,i])}return e.sort(function(t,e){return t[0]-e[0]}),e}function o(e,o,n){if("categories"==e[o].options.mode){if(!e[o].categories){var s={},a=e[o].options.categories||{};if(t.isArray(a))for(var r=0;r<a.length;++r)s[a[r]]=r;else for(var l in a)s[l]=a[l];e[o].categories=s}e[o].options.ticks||(e[o].options.ticks=i),function(t,e,i){for(var o=t.points,n=t.pointsize,s=t.format,a=e.charAt(0),r=function(t){var e=-1;for(var i in t)t[i]>e&&(e=t[i]);return e+1}(i),l=0;l<o.length;l+=n)if(null!=o[l])for(var h=0;h<n;++h){var u=o[l+h];null!=u&&s[h][a]&&(u in i||(i[u]=r,++r),o[l+h]=i[u])}}(n,o,e[o].categories)}}function n(t,e,i){o(e,"xaxis",i),o(e,"yaxis",i)}t.plot.plugins.push({init:function(t){t.hooks.processRawData.push(e),t.hooks.processDatapoints.push(n)},options:{xaxis:{categories:null},yaxis:{categories:null}},name:"categories",version:"1.0"})}(jQuery)},,,,,,,,,,,,,,,function(t,e){t.exports=r},function(t,e){t.exports=l},function(t,e){!function(t){function e(){return!!document.createElement("canvas").getContext&&"function"==typeof document.createElement("canvas").getContext("2d").fillText}function i(){var t=document.createElement("div");return void 0!==t.style.MozTransition||void 0!==t.style.OTransition||void 0!==t.style.webkitTransition||void 0!==t.style.transition}function o(t,e,i,o,n){this.axisName=t,this.position=e,this.padding=i,this.plot=o,this.opts=n,this.width=0,this.height=0}function n(t,e,i,n,s){o.prototype.constructor.call(this,t,e,i,n,s)}function s(t,e,i,n,s){o.prototype.constructor.call(this,t,e,i,n,s),this.elem=null}function a(t,e,i,o,n){s.prototype.constructor.call(this,t,e,i,o,n)}function r(t,e,i,o,n){a.prototype.constructor.call(this,t,e,i,o,n),this.requiresResize=!1}o.prototype.cleanup=function(){},n.prototype=new o,n.prototype.constructor=n,n.prototype.calculateSize=function(){this.opts.axisLabelFontSizePixels||(this.opts.axisLabelFontSizePixels=14),this.opts.axisLabelFontFamily||(this.opts.axisLabelFontFamily="sans-serif");this.opts.axisLabelFontSizePixels,this.padding,this.opts.axisLabelFontSizePixels,this.padding;"left"==this.position||"right"==this.position?(this.width=this.opts.axisLabelFontSizePixels+this.padding,this.height=0):(this.width=0,this.height=this.opts.axisLabelFontSizePixels+this.padding)},n.prototype.draw=function(t){this.opts.axisLabelColour||(this.opts.axisLabelColour="black");var e=this.plot.getCanvas().getContext("2d");e.save(),e.textAlign="left",e.font=this.opts.axisLabelFontSizePixels+"px "+this.opts.axisLabelFontFamily,e.fillStyle=this.opts.axisLabelColour;var i,o,n=e.measureText(this.opts.axisLabel).width,s=this.opts.axisLabelFontSizePixels,a=0;"top"==this.position?(i=t.left+t.width/2-n/2,o=t.top+.72*s):"bottom"==this.position?(i=t.left+t.width/2-n/2,o=t.top+t.height-.72*s):"left"==this.position?(i=t.left+.72*s,o=t.height/2+t.top+n/2,a=-Math.PI/2):"right"==this.position&&(i=t.left+t.width-.72*s,o=t.height/2+t.top-n/2,a=Math.PI/2),e.translate(i,o),e.rotate(a),e.fillText(this.opts.axisLabel,0,0),e.restore()},s.prototype=new o,s.prototype.constructor=s,s.prototype.calculateSize=function(){var e=t('<div class="axisLabels" style="position:absolute;">'+this.opts.axisLabel+"</div>");this.plot.getPlaceholder().append(e),this.labelWidth=e.outerWidth(!0),this.labelHeight=e.outerHeight(!0),e.remove(),this.width=this.height=0,"left"==this.position||"right"==this.position?this.width=this.labelWidth+this.padding:this.height=this.labelHeight+this.padding},s.prototype.cleanup=function(){this.elem&&this.elem.remove()},s.prototype.draw=function(e){this.plot.getPlaceholder().find("#"+this.axisName+"Label").remove(),this.elem=t('<div id="'+this.axisName+'Label" " class="axisLabels" style="position:absolute;">'+this.opts.axisLabel+"</div>"),this.plot.getPlaceholder().append(this.elem),"top"==this.position?(this.elem.css("left",e.left+e.width/2-this.labelWidth/2+"px"),this.elem.css("top",e.top+"px")):"bottom"==this.position?(this.elem.css("left",e.left+e.width/2-this.labelWidth/2+"px"),this.elem.css("top",e.top+e.height-this.labelHeight+"px")):"left"==this.position?(this.elem.css("top",e.top+e.height/2-this.labelHeight/2+"px"),this.elem.css("left",e.left+"px")):"right"==this.position&&(this.elem.css("top",e.top+e.height/2-this.labelHeight/2+"px"),this.elem.css("left",e.left+e.width-this.labelWidth+"px"))},a.prototype=new s,a.prototype.constructor=a,a.prototype.calculateSize=function(){s.prototype.calculateSize.call(this),this.width=this.height=0,"left"==this.position||"right"==this.position?this.width=this.labelHeight+this.padding:this.height=this.labelHeight+this.padding},a.prototype.transforms=function(t,e,i){var o={"-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":""};if(0!=e||0!=i){var n=" translate("+e+"px, "+i+"px)";o["-moz-transform"]+=n,o["-webkit-transform"]+=n,o["-o-transform"]+=n,o["-ms-transform"]+=n}if(0!=t){var s=" rotate("+t+"deg)";o["-moz-transform"]+=s,o["-webkit-transform"]+=s,o["-o-transform"]+=s,o["-ms-transform"]+=s}var a="top: 0; left: 0; ";for(var r in o)o[r]&&(a+=r+":"+o[r]+";");return a+=";"},a.prototype.calculateOffsets=function(t){var e={x:0,y:0,degrees:0};return"bottom"==this.position?(e.x=t.left+t.width/2-this.labelWidth/2,e.y=t.top+t.height-this.labelHeight):"top"==this.position?(e.x=t.left+t.width/2-this.labelWidth/2,e.y=t.top):"left"==this.position?(e.degrees=-90,e.x=t.left-this.labelWidth/2+this.labelHeight/2,e.y=t.height/2+t.top):"right"==this.position&&(e.degrees=90,e.x=t.left+t.width-this.labelWidth/2-this.labelHeight/2,e.y=t.height/2+t.top),e.x=Math.round(e.x),e.y=Math.round(e.y),e},a.prototype.draw=function(e){this.plot.getPlaceholder().find("."+this.axisName+"Label").remove();var i=this.calculateOffsets(e);this.elem=t('<div class="axisLabels '+this.axisName+'Label" style="position:absolute; '+this.transforms(i.degrees,i.x,i.y)+'">'+this.opts.axisLabel+"</div>"),this.plot.getPlaceholder().append(this.elem)},r.prototype=new a,r.prototype.constructor=r,r.prototype.transforms=function(t,e,i){var o="";if(0!=t){for(var n=t/90;n<0;)n+=4;o+=" filter: progid:DXImageTransform.Microsoft.BasicImage(rotation="+n+"); ",this.requiresResize="right"==this.position}return 0!=e&&(o+="left: "+e+"px; "),0!=i&&(o+="top: "+i+"px; "),o},r.prototype.calculateOffsets=function(t){var e=a.prototype.calculateOffsets.call(this,t);return"top"==this.position?e.y=t.top+1:"left"==this.position?(e.x=t.left,e.y=t.height/2+t.top-this.labelWidth/2):"right"==this.position&&(e.x=t.left+t.width-this.labelHeight,e.y=t.height/2+t.top-this.labelWidth/2),e},r.prototype.draw=function(t){a.prototype.draw.call(this,t),this.requiresResize&&(this.elem=this.plot.getPlaceholder().find("."+this.axisName+"Label"),this.elem.css("width",this.labelWidth),this.elem.css("height",this.labelHeight))},t.plot.plugins.push({init:function(o){o.hooks.processOptions.push(function(o,l){if(l.axisLabels.show){var h=!1,u={};o.hooks.draw.push(function(o,l){var p=!1;h?(h=!1,t.each(o.getAxes(),function(t,e){var i=e.options||o.getOptions()[t];i&&i.axisLabel&&e.show&&u[t].draw(e.box)})):(t.each(o.getAxes(),function(t,l){var h=l.options||o.getOptions()[t];if(t in u&&(l.labelHeight=l.labelHeight-u[t].height,l.labelWidth=l.labelWidth-u[t].width,h.labelHeight=l.labelHeight,h.labelWidth=l.labelWidth,u[t].cleanup(),delete u[t]),h&&h.axisLabel&&l.show){p=!0;var c=null;if(h.axisLabelUseHtml||"Microsoft Internet Explorer"!=navigator.appName)c=h.axisLabelUseHtml||!i()&&!e()&&!h.axisLabelUseCanvas?s:h.axisLabelUseCanvas||!i()?n:a;else{var f=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(f)&&(rv=parseFloat(RegExp.$1)),c=rv>=9&&!h.axisLabelUseCanvas&&!h.axisLabelUseHtml?a:h.axisLabelUseCanvas||h.axisLabelUseHtml?h.axisLabelUseCanvas?n:s:r}var d=void 0===h.axisLabelPadding?2:h.axisLabelPadding;u[t]=new c(t,l.position,d,o,h),u[t].calculateSize(),h.labelHeight=l.labelHeight+u[t].height,h.labelWidth=l.labelWidth+u[t].width}}),p&&(h=!0,o.setupGrid(),o.draw()))})}})},options:{axisLabels:{show:!0}},name:"axisLabels",version:"2.0"})}(jQuery)},,,,,function(t,e,i){"use strict";i.r(e);var o=i(2),n=i.n(o),s=i(3),a=i.n(s),r=i(6),l=i.n(r),h=i(4),u=i.n(h),p=i(5),c=i.n(p),f=i(7),d=i.n(f),g=i(8),b=i(0),m=i.n(b),y=i(9),v=i.n(y),x=i(14),w=i.n(x),L=(i(30),i(48),i(31),i(32),i(49),i(50),i(33),function(t){function e(t,i,o){var s;n()(this,e),(s=l()(this,u()(e).call(this,t,i))).scope=t,s.$timeout=o;var a=m.a.findIndex(v.a.plot.plugins,function(t){return"categories"===t.name}),r=m.a.findIndex(v.a.plot.plugins,function(t){return"stack"===t.name});if(a>=0&&r>=0&&a>r){var h=v.a.plot.plugins[r];v.a.plot.plugins[r]=v.a.plot.plugins[a],v.a.plot.plugins[a]=h}return s._renderRetries=0,m.a.defaults(s.panel,{direction:"horizontal",units:"b",display:"total",mode:"separate",legendPosition:"right"}),s.retryTimes=10,s.retryDelay=100,s.events.on("init-edit-mode",s.onInitEditMode.bind(c()(s))),s.events.on("data-received",s.onDataReceived.bind(c()(s))),s.events.on("data-error",s.onDataError.bind(c()(s))),s.events.on("data-snapshot-load",s.onDataReceived.bind(c()(s))),s.events.on("render",s.onRender.bind(c()(s))),s}return e.$inject=["$scope","$injector","$timeout"],d()(e,t),a()(e,[{key:"link",value:function(t,e,i,o){this.elem=e.find(".histogram-chart"),this.legendContainer=e.find("#legend-container"),this.wrapper=e.find(".graph-canvas-wrapper"),this.ctrl=o}},{key:"onInitEditMode",value:function(){this.addEditorTab("Grouping","public/plugins/opennms-helm-app/panels/flow-histogram/editor.html",2)}},{key:"onDataReceived",value:function(t){var i=e.getUnits(t,this.panel.units);this.units=i.units;var o=this.getLabeledValues(t);this.series=this.getSeries(o,i.divisor),this.render()}},{key:"onDataError",value:function(){this.series=[],this.render()}},{key:"onRender",value:function(){var t=this;this.elem.empty(),this.legendContainer&&this.legendContainer.empty();var e=this.ctrl.height||this.ctrl.panel.height||this.ctrl.row&&this.ctrl.row.height;if(m.a.isString(e)&&(e=parseInt(e.replace("px",""),10)),0===this.elem.width()||0===e||void 0===e)return this._renderRetries>this.retryTimes?(console.log("onRender: still unable to determine height, and we ran out of retries"),!1):(this._renderRetries++,console.log("onRender: unable to determine height, retrying again in "+this.retryDelay+"ms"),this.$timeout(function(){t.onRender()},this.retryDelay),!0);switch(e-=5,e-=this.ctrl.panel.title?24:9,this.panel.legendPosition){case"right":this.legendContainer.css("height",e+"px"),this.legendContainer.removeClass("legend-container-bottom"),this.legendContainer.addClass("legend-container-right"),this.wrapper.css("display","flex"),this.elem.css("width","100%");break;case"bottom":this.legendContainer.css("height",""),this.legendContainer.removeClass("legend-container-right"),this.legendContainer.addClass("legend-container-bottom"),this.wrapper.css("display",""),this.elem.css("width",""),e-=this.legendContainer.height()}this.elem.css("height",e+"px");var i=this.getSeriesData(this.series,this.panel.direction,this.panel.mode),o=this.getOptions(i);v.a.plot(this.elem,i,o)}},{key:"getLabeledValues",value:function(t){var i,o=t[0];switch(o.vars.metric){case"applications":i=function(t,e){return e[t.indexOf("application")]};break;case"hosts":i=function(t,e){return e[t.indexOf("host")]};break;case"conversations":i=function(t,e){return e[t.indexOf("Source IP")]+" <-> "+e[t.indexOf("Dest. IP")]+" ["+e[t.indexOf("Application")]+"]"}}var n=e.extractValueAndLabel(t,o.vars.toBits?"Bits In":"Bytes In","In",i),s=e.extractValueAndLabel(t,o.vars.toBits?"Bits Out":"Bytes Out","Out",i);if("rate"===this.panel.display){this.units+="/s";var a=w.a.duration(this.range.to.diff(this.range.from)).asSeconds();n=m.a.map(n,function(t){return{key:t.key,value:t.value/a}}),s=m.a.map(s,function(t){return{key:t.key,value:t.value/a}})}return{inByLabel:n,outByLabel:s}}},{key:"getSeries",value:function(t,i){var o=[];switch(this.panel.direction){case"horizontal":for(var n=t.inByLabel.length-1;n>=0;n--)o.push(e.generateResultObject(t.outByLabel,n,i,"#DB4345")),o.push(e.generateResultObject(t.inByLabel,n,i,"#86B15B"));break;case"vertical":for(var s=0;s<t.inByLabel.length;s++)o.push(e.generateResultObject(t.inByLabel,s,i,"#86B15B")),o.push(e.generateResultObject(t.outByLabel,s,i,"#DB4345"))}return o}},{key:"getOptions",value:function(t){var e={bars:{show:!0,barWidth:.6,align:"center",fill:.8,lineWidth:1},stack:"stacked"===this.panel.mode},i={mode:"categories",tickLength:0,autoscaleMargin:.02},o=[{axisLabel:this.units}],n="bottom"===this.panel.legendPosition?"flow-histogram-label-bottom":"flow-histogram-label-right",s={legend:{show:!0,sorted:"stacked"===this.panel.mode?null:"ascending",container:this.legendContainer,noColumns:"bottom"===this.panel.legendPosition?t.length:1,labelBoxBorderColor:null,labelFormatter:function(t,e){return'<span class="'+n+'">'+t+"</span>"}},axisLabels:{show:!0},series:e,grid:{borderWidth:0}};switch(this.panel.direction){case"horizontal":s.xaxes=o,e.bars.horizontal=!0,s.yaxis=i;break;case"vertical":s.yaxes=o,e.bars.horizontal=!1,s.xaxis=i}return s}},{key:"getSeriesData",value:function(t,i,o){var n;switch(o){case"separate":var s={label:"In",data:(n=e.getData(this.series,this.panel.direction)).dataIn,bars:{show:!0,barWidth:.2},color:"#86B15B"},a={label:"Out",data:n.dataOut,bars:{show:!0,barWidth:.2},color:"#DB4345"};switch(i){case"horizontal":return s.bars.align="left",a.bars.align="right",[s,a];case"vertical":return s.bars.align="right",a.bars.align="left",[a,s]}break;case"stacked":n=e.getDataStacked(this.series,this.panel.direction);for(var r=[],l=0,h=Object.keys(n);l<h.length;l++){var u=h[l];r.push({label:u,data:n[u]})}return r}}}],[{key:"getData",value:function(t,e){var i=[],o=[];switch(e){case"horizontal":for(var n=0,s=1;n<t.length-1;n+=2,s+=2)o.push([t[n].count,t[n].name]),i.push([t[s].count,t[s].name]);break;case"vertical":for(var a=0,r=1;a<t.length-1;a+=2,r+=2)i.push([t[a].name,t[a].count]),o.push([t[r].name,t[r].count])}return{dataIn:i,dataOut:o}}},{key:"getDataStacked",value:function(t,e){var i={};switch(e){case"horizontal":for(var o=t.length-2,n=t.length-1;o>=0;o-=2,n-=2)i[t[o].name]=[],i[t[o].name].push([t[o].count,"Out"]),i[t[o].name].push([t[n].count,"In"]);break;case"vertical":for(var s=0,a=1;s<t.length-1;s+=2,a+=2)i[t[s].name]=[],i[t[s].name].push(["In",t[s].count]),i[t[s].name].push(["Out",t[a].count])}return i}},{key:"extractValueAndLabel",value:function(t,e,i,o){var n=[],s=t[0].columns.map(function(t){return t.text}),a=s.indexOf(e);return t[0].rows.forEach(function(t){n.push({key:o(s,t),value:t[a]})}),n}},{key:"getUnits",value:function(t,e){var i,o=t[0],n=1;switch(e){case"b":i=o.vars.toBits?"Bits":"Bytes";break;case"kb":n=1024,i=o.vars.toBits?"Kb":"KB";break;case"mb":n=Math.pow(1024,2),i=o.vars.toBits?"Mb":"MB";break;case"gb":n=Math.pow(1024,3),i=o.vars.toBits?"Gb":"GB"}return{divisor:n,units:i}}},{key:"generateResultObject",value:function(t,e,i,o){return{name:t[e].key,count:m.a.defaultTo(t[e].value,0)/i,color:o}}}]),e}(g.MetricsPanelCtrl));L.templateUrl="panels/flow-histogram/module.html",i.d(e,"PanelCtrl",function(){return L}),Object(g.loadPluginCss)({dark:"plugins/opennms-helm-app/panels/flow-histogram/css/legend.dark.css",light:"plugins/opennms-helm-app/panels/flow-histogram/css/legend.light.css"})}])});