{"version":3,"sources":["../../../src/datasources/fault-ds/datasource.js"],"names":["ClientDelegate","API","Model","FilterCloner","Mapping","_","FeaturedAttributes","isNumber","num","parseInt","OpenNMSFMDatasource","instanceSettings","$q","backendSrv","templateSrv","contextSrv","type","url","name","q","alarmClient","jsonData","useGrafanaUser","grafanaUserField","user","login","options","filter","targets","Filter","limit","enforceTimeRange","clonedFilter","buildQuery","self","findAlarms","then","getClientWithMetadata","data","toTable","alarms","client","server","metadata","cloneFilter","withAndRestriction","NestedRestriction","Restriction","Comparators","GE","LE","substitute","clauses","variables","length","v","undefined","clause","restriction","attribute","value","indexOf","comparator","id","EQ","console","log","nodeCriteria","split","replacement","Clause","Operators","AND","remove","each","variableName","getVariableName","templateVariable","_getTemplateVariable","multi","current","isAllValue","push","isArray","values","withOrRestriction","NE","Error","range","from","to","replace","scopedVars","subtituteNodeRestriction","r","i","splice","status","message","title","catch","e","when","query","find","strategy","featuredAttributes","map","sortBy","getProperties","AttributeMapping","getApiAttribute","getPropertyComparators","searchForValues","findOperators","label","findProperty","property","severities","Severities","severity","findValues","columnNames","parameterNames","uniq","flatten","alarm","lastEvent","parameters","parameter","parameterName","columns","column","rows","row","count","ackUser","ackTime","uei","description","location","logMessage","reductionKey","troubleTicket","troubleTicketState","nodeId","nodeLabel","service","suppressedTime","suppressedUntil","suppressedBy","ipAddress","address","firstEventTime","time","source","createTime","sticky","body","author","updated","created","journal","relatedAlarms","toFixed","affectedNodeCount","managedObjectInstance","managedObjectType","eventParametersByName","concat","has","meta","ticketerConfig","alarmId","getAlarm","doAck","doUnack","doClear","doEscalate","doTicketAction","saveSticky","deleteSticky","saveJournal","deleteJournal","situationId","getSituationfeedback","feedback","submitSituationFeedback"],"mappings":"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","file":"datasource.js","sourcesContent":["import {ClientDelegate} from '../../lib/client_delegate';\nimport {API, Model} from '../../opennms';\nimport {FilterCloner} from './FilterCloner';\nimport {Mapping} from './Mapping';\nimport _ from 'lodash';\n\nconst FeaturedAttributes = [\n    \"affectedNodeCount\", \"alarmAckTime\", \"category\", \"ipAddress\",\n    \"isSituation\", \"isInSituation\", \"location\", \"node\", \"node.label\", \"reductionKey\",\n    \"service\", \"severity\", \"situationAlarmCount\", \"uei\"\n];\n\nconst isNumber = function isNumber(num) {\n    return ((parseInt(num,10) + '') === (num + ''));\n};\n\nexport class OpenNMSFMDatasource {\n\n  constructor(instanceSettings, $q, backendSrv, templateSrv, contextSrv) {\n    this.type = instanceSettings.type;\n    this.url = instanceSettings.url;\n    this.name = instanceSettings.name;\n    this.q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.alarmClient = new ClientDelegate(instanceSettings, backendSrv, $q);\n\n    // When enabled in the datasource, the grafana user should be used instead of the datasource username on\n    // supported operations\n    if (instanceSettings.jsonData && instanceSettings.jsonData.useGrafanaUser) {\n        // If the datasource contains the field which should be used and that field is set, use it\n        if (instanceSettings.jsonData.grafanaUserField && contextSrv.user[instanceSettings.jsonData.grafanaUserField]) {\n            this.user = contextSrv.user[instanceSettings.jsonData.grafanaUserField];\n        } else { // otherwise the login is used instead\n            this.user = contextSrv.user.login;\n        }\n    }\n  }\n\n  query(options) {\n      // Initialize filter\n      var filter = options.targets[0].filter || new API.Filter();\n      filter.limit = 0; // no limit\n\n      options.enforceTimeRange = true;\n      const clonedFilter = this.buildQuery(filter, options);\n\n      var self = this;\n      return this.alarmClient.findAlarms(clonedFilter).then(alarms => {\n          return this.alarmClient.getClientWithMetadata().then(client => {\n              return {\n                data: self.toTable(alarms, client.server.metadata)\n              };\n          });\n      });\n  }\n\n  // Clone Filter to make substitution possible\n  // (otherwise substitution would happen in original query,\n  // and overwriting the $<variable> or [[variable]] in restrictions which may not be the intention)\n  buildQuery(filter, options) {\n      var clonedFilter = new FilterCloner().cloneFilter(filter);\n\n      // Before replacing any variables, add a global time range restriction (which is hidden to the user)\n      if (options && options.enforceTimeRange) {\n          clonedFilter.withAndRestriction(\n              new API.NestedRestriction()\n                  .withAndRestriction(new API.Restriction(\"lastEventTime\", API.Comparators.GE, \"$range_from\"))\n                  .withAndRestriction(new API.Restriction(\"lastEventTime\", API.Comparators.LE, \"$range_to\")));\n      }\n\n      // Substitute $<variable> or [[variable]] in the restriction value\n      this.substitute(clonedFilter.clauses, options);\n      return clonedFilter;\n  }\n\n  _getTemplateVariable(name) {\n    if (this.templateSrv.variables && this.templateSrv.variables.length > 0) {\n        return this.templateSrv.variables.filter((v) => {\n            return v.name === name;\n        })[0];\n    }\n    return undefined;\n  }\n\n  subtituteNodeRestriction(clause) {\n    const restriction = clause.restriction;\n    // Handle \"node\" as a special case, updating restrictions to either foreignSource+foreignId or node.id\n    if (restriction.attribute === 'node') {\n        if (restriction.value.indexOf(':') > 0) {\n            if (restriction.comparator.id !== API.Comparators.EQ.id) {\n                console.log('WARNING: Using a comparator other than EQ will probably not work as expected with a foreignSource:foreignId node criteria.');\n            }\n            const nodeCriteria = restriction.value.split(':');\n            const replacement = new API.NestedRestriction(\n                new API.Clause(new API.Restriction('node.foreignSource', restriction.comparator, nodeCriteria[0]), API.Operators.AND),\n                new API.Clause(new API.Restriction('node.foreignId', restriction.comparator, nodeCriteria[1]), API.Operators.AND),\n            );\n            clause.restriction = replacement;\n        } else if (isNumber(restriction.value)) {\n            clause.restriction = new API.Restriction('node.id', restriction.comparator, restriction.value);\n        } else {\n            console.log('WARNING: found a \"node\" criteria but it does not appear to be a node ID nor a foreignSource:foreignId tuple.',restriction);\n        }\n    } \n  }\n\n  substitute(clauses, options) {\n      const self = this;\n      const remove = [];\n      _.each(clauses, clause => {\n        if (clause.restriction) {\n            const restriction = clause.restriction;\n            if (restriction instanceof API.NestedRestriction) {\n                self.substitute(restriction.clauses, options);\n            } else if (restriction.value) {\n                const variableName = self.templateSrv.getVariableName(restriction.value);\n                const templateVariable = self._getTemplateVariable(variableName);\n\n                // Process multi-selects\n                if (templateVariable && templateVariable.multi) {\n                    if (templateVariable.current.value && self.templateSrv.isAllValue(templateVariable.current.value)) {\n                        // if we're querying \"all\" we just dump the clause altogether\n                        remove.push(clause);\n                    } else {\n                        // annoyingly, depending on how you interact with the UI, if one value is selected it will\n                        // *either* be an array with 1 entry, or just the raw value >:|\n                        // so we normalize it back to just the raw value here if necessary\n                        if (_.isArray(templateVariable.current.value) && templateVariable.current.value.length === 1) {\n                            templateVariable.current.value = templateVariable.current.value[0];\n                        }\n\n                        // now if it's *still* an array, we chop it up into nested restrictions\n                        if (_.isArray(templateVariable.current.value)) {\n                            const replacement = new API.NestedRestriction();\n                            let values = templateVariable.current.value;\n                            if (!_.isArray(values)) {\n                                values = [values];\n                            }\n                            for (const value of values) {\n                                if (restriction.comparator.id === API.Comparators.EQ.id) {\n                                    replacement.withOrRestriction(new API.Restriction(restriction.attribute, restriction.comparator, value));\n                                } else if (restriction.comparator.id === API.Comparators.NE.id) {\n                                    replacement.withAndRestriction(new API.Restriction(restriction.attribute, restriction.comparator, value));\n                                } else {\n                                    throw new Error('Unable to query \"' + restriction.attribute + '\": multi-select values with variable substitution must be either \"=\" or \"!=\"');\n                                }\n                            }\n\n                            // we've turned a single restriction into a nested one, so re-process it as a\n                            // collection and skip the simple replacement below\n                            clause.restriction = replacement;\n                            self.substitute(clause.restriction.clauses, options);\n                            return;\n                        }\n                    }\n                }\n\n                // Range must be of type date, otherwise it is not parseable by the OpenNMS client\n                if (variableName === 'range_from') {\n                    restriction.value = options.range.from;\n                } else if (variableName === 'range_to') {\n                    restriction.value = options.range.to;\n                } else {\n                    restriction.value = self.templateSrv.replace(restriction.value, options.scopedVars);\n                }\n\n                self.subtituteNodeRestriction(clause);\n            }\n        }\n      });\n      for (const r of remove) {\n        const i = clauses.indexOf(r);\n        if (i >= 0) {\n            clauses.splice(i, 1);\n        }\n      }\n    }\n\n  testDatasource() {\n      return this.alarmClient.getClientWithMetadata()\n          .then(metadata => {\n              if (metadata) {\n                  return {\n                      status: \"success\",\n                      message: \"Data source is working\",\n                      title: \"Success\"\n                  };\n              } else {\n                return {\n                  status: \"danger\",\n                  message: \"OpenNMS provided a response, but no metadata was found.\",\n                  title: \"Unexpected Response\"\n                }\n              }\n          }).catch(e => {\n              if (e.message === \"Unsupported Version\") {\n                  return {\n                      status: \"danger\",\n                      message: \"The OpenNMS version you are trying to connect to is not supported. \" +\n                               \"OpenNMS Horizon version >= 20.1.0 or OpenNMS Meridian version >= 2017.1.0 is required.\",\n                      title: e.message\n                  }\n              } else {\n                  throw e;\n              }\n          });\n  }\n\n  annotationQuery(options) {\n    return this.q.when([]);\n  }\n\n  metricFindQuery(query) {\n    if (!query || !query.find) {\n        return this.q.when([]);\n    }\n\n    if (query.find === \"attributes\") {\n        if (query.strategy === 'featured') {\n            const featuredAttributes = _.map(_.sortBy(FeaturedAttributes), (attribute) => {\n                return {id: attribute}\n            });\n            return this.q.when(featuredAttributes);\n        }\n        // assume all\n        return this.alarmClient.getProperties();\n    }\n    if (query.find === \"comparators\") {\n        const attribute = new Mapping.AttributeMapping().getApiAttribute(query.attribute);\n        return this.alarmClient.getPropertyComparators(attribute);\n    }\n    if (query.find == 'values') {\n        return this.searchForValues(query);\n    }\n    if (query.find === 'operators') {\n        return this.alarmClient.findOperators();\n    }\n    return this.q.when([]);\n  }\n\n  searchForValues(query) {\n      let attribute = new Mapping.AttributeMapping().getApiAttribute(query.attribute);\n      if (attribute === 'ipAddr') {\n          attribute = 'ipInterface.ipAddress';\n      }\n      if (attribute === 'isSituation' || attribute === 'isInSituation') {\n        return this.q.when([{ id: 'false', label: 'false'}, {id: 'true', label: 'true'}]);\n      }\n      return this.alarmClient.findProperty(attribute)\n          .then(property => {\n              if (!property) {\n                  return this.q.when([]);\n              }\n              // Special handling for properties\n              switch(property.id) {\n                  // Severity is handled separately as otherwise the severity ordinal vs the severity label would be\n                  // used, but that may not be ideal for the user\n                  case 'severity':\n                      const severities = _.map(Model.Severities, severity => {\n                          return {\n                              id: severity.id,\n                              label: severity.label\n                          }\n                      });\n                      return this.q.when(severities);\n              }\n              return property.findValues({limit: 1000}).then(values => {\n                  return values.map(value => {\n                      return {id: value, label: value}\n                  });\n              });\n          });\n  }\n\n    // Converts the data fetched from the Alarm REST Endpoint of OpenNMS to the grafana table model\n    toTable(alarms, metadata) {\n        let columnNames = [\n            \"ID\", \"Count\", \"Acked By\", \"Ack Time\", \"UEI\", \"Severity\",\n            \"Type\", \"Description\", \"Location\", \"Log Message\", \"Reduction Key\",\n            \"Trouble Ticket\", \"Trouble Ticket State\", \"Node ID\", \"Node Label\", \"Service\",\n            \"Suppressed Time\", \"Suppressed Until\", \"Suppressed By\", \"IP Address\",\n            \"First Event Time\", \"Last Event ID\", \"Last Event Time\", \"Last Event Source\",\n            \"Last Event Creation Time\", \"Last Event Severity\", \"Last Event Label\", \"Last Event Location\",\n            \"Sticky ID\", \"Sticky Note\", \"Sticky Author\", \"Sticky Update Time\", \"Sticky Creation Time\",\n            \"Journal ID\", \"Journal Note\", \"Journal Author\", \"Journal Update Time\", \"Journal Creation Time\",\n            \"Is Situation\", \"Situation Alarm Count\", \"Affected Node Count\",\n            \"Managed Object Instance\", \"Managed Object Type\",\n            \"Data Source\"\n        ];\n\n        // Build a sorted list of (unique) event parameter names\n        let parameterNames = _.uniq(_.sortBy(_.flatten(_.map(alarms, alarm => {\n          if (!alarm.lastEvent || !alarm.lastEvent.parameters) {\n            return [];\n          }\n          return _.map(alarm.lastEvent.parameters, parameter => {\n            return parameter.name;\n          });\n        })), name => name), true);\n\n        // Include the event parameters as columns\n        _.each(parameterNames, parameterName => {\n          columnNames.push(\"Param_\" + parameterName);\n        });\n\n        let columns = _.map(columnNames, column => {\n            return { \"text\" : column }\n        });\n\n        let self = this;\n        let rows = _.map(alarms, alarm => {\n            let row = [\n                alarm.id,\n                alarm.count,\n                alarm.ackUser,\n                alarm.ackTime,\n                alarm.uei,\n                alarm.severity.label,\n                alarm.type ? alarm.type.label : undefined,\n                alarm.description,\n                alarm.location,\n\n                alarm.logMessage,\n                alarm.reductionKey,\n                alarm.troubleTicket,\n                alarm.troubleTicketState ? alarm.troubleTicketState.label : undefined,\n                alarm.nodeId,\n                alarm.nodeLabel,\n                alarm.service ? alarm.service.name : undefined,\n                alarm.suppressedTime,\n                alarm.suppressedUntil,\n                alarm.suppressedBy,\n                alarm.lastEvent ? alarm.lastEvent.ipAddress ? alarm.lastEvent.ipAddress.address : undefined : undefined,\n\n                // Event\n                alarm.firstEventTime,\n                alarm.lastEvent ? alarm.lastEvent.id : undefined,\n                alarm.lastEvent ? alarm.lastEvent.time : undefined,\n                alarm.lastEvent ? alarm.lastEvent.source : undefined,\n                alarm.lastEvent ? alarm.lastEvent.createTime : undefined,\n                alarm.lastEvent ? alarm.lastEvent.severity.label : undefined,\n                alarm.lastEvent ? alarm.lastEvent.label : undefined,\n                alarm.lastEvent ? alarm.lastEvent.location : undefined,\n\n                // Sticky Note\n                alarm.sticky ? alarm.sticky.id : undefined,\n                alarm.sticky ? alarm.sticky.body : undefined,\n                alarm.sticky ? alarm.sticky.author : undefined,\n                alarm.sticky ? alarm.sticky.updated : undefined,\n                alarm.sticky ? alarm.sticky.created : undefined,\n\n                // Journal Note\n                alarm.journal ? alarm.journal.id : undefined,\n                alarm.journal ? alarm.journal.body : undefined,\n                alarm.journal ? alarm.journal.author : undefined,\n                alarm.journal ? alarm.journal.updated : undefined,\n                alarm.journal ? alarm.journal.created : undefined,\n\n                // Situation Data\n                alarm.relatedAlarms && alarm.relatedAlarms.length > 0 ? 'Y' : 'N',\n                alarm.relatedAlarms ? alarm.relatedAlarms.length.toFixed(0) : undefined,\n                alarm.affectedNodeCount ? alarm.affectedNodeCount.toFixed(0) : undefined,\n                alarm.managedObjectInstance ? alarm.managedObjectInstance : undefined,\n                alarm.managedObjectType ? alarm.managedObjectType : undefined,\n\n                // Data Source\n                self.name\n            ];\n\n            // Index the event parameters by name\n            let eventParametersByName = {};\n            if (alarm.lastEvent && alarm.lastEvent.parameters) {\n              _.each(alarm.lastEvent.parameters, parameter => {\n                eventParametersByName[parameter.name] = parameter.value;\n              });\n            }\n\n            // Append the event parameters to the row\n            row = row.concat(_.map(parameterNames, parameterName => {\n              if (_.has(eventParametersByName, parameterName)) {\n                return eventParametersByName[parameterName];\n              } else {\n                return undefined;\n              }\n            }));\n\n            row.meta = {\n                // Store the alarm for easy access by the panels - may not be necessary\n                'alarm': alarm,\n                // Store the name of the data-source as part of the data so that\n                // the panel can grab an instance of the DS to perform actions\n                // on the alarms\n                \"source\": this.name,\n                // Store the ticketerConfig here\n                \"ticketerConfig\": metadata.ticketerConfig\n            };\n            return row;\n        });\n\n        return [\n            {\n                \"columns\": columns,\n                \"rows\": rows,\n                \"type\": \"table\",\n            }\n        ];\n    }\n\n    getAlarm(alarmId) {\n        return this.alarmClient.getAlarm(alarmId);\n    }\n\n    acknowledgeAlarm(alarmId) {\n        return this.alarmClient.doAck(alarmId, this.user);\n    }\n\n    unacknowledgeAlarm(alarmId) {\n        return this.alarmClient.doUnack(alarmId, this.user);\n    }\n\n    clearAlarm(alarmId) {\n        return this.alarmClient.doClear(alarmId, this.user);\n    }\n\n    escalateAlarm(alarmId) {\n        return this.alarmClient.doEscalate(alarmId, this.user);\n    }\n\n    createTicketForAlarm(alarmId) {\n        return this.alarmClient.doTicketAction(alarmId, \"create\");\n    }\n\n    updateTicketForAlarm(alarmId) {\n        return this.alarmClient.doTicketAction(alarmId, \"update\");\n    }\n\n    closeTicketForAlarm(alarmId) {\n        return this.alarmClient.doTicketAction(alarmId, \"close\");\n    }\n\n    saveSticky(alarmId, sticky) {\n        return this.alarmClient.saveSticky(alarmId, sticky, this.user);\n    }\n\n    deleteSticky(alarmId) {\n        return this.alarmClient.deleteSticky(alarmId);\n    }\n\n    saveJournal(alarmId, journal) {\n        return this.alarmClient.saveJournal(alarmId, journal, this.user);\n    }\n\n    deleteJournal(alarmId) {\n        return this.alarmClient.deleteJournal(alarmId);\n    }\n\n    // Situation Feedback\n\n    getSituationFeedback(situationId) {\n        return this.alarmClient.getSituationfeedback(situationId);\n    }\n\n    submitSituationFeedback(situationId, feedback) {\n        return this.alarmClient.submitSituationFeedback(situationId, feedback);\n    }\n}\n"]}