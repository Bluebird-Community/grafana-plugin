{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"lodash\"","webpack:///./components/config.ts","webpack:///./module.ts","webpack:///./lib/utils.ts","webpack:///external \"@grafana/runtime\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__WEBPACK_EXTERNAL_MODULE__0__","this","appModel","jsonData","actions","data","addAction","push","url","removeAction","actionIndex","splice","OpenNMSHelmAppConfigCtrl","templateUrl","cssInitialized","initializeCss","dark","light","assignModelProperties","target","source","defaults","undefined","selectOptionsForCurrentValue","variable","y","option","selected","options","length","isArray","current","setOptionAsCurrent","cloneDeep","text","join","emitChangeEvents","$q","dashboardSrv","templateSrv","initLock","when","variables","getVariables","dashboard","promises","forEach","v","setGlobalVariable","id","all","then","templateVariableValueUpdated","startRefresh","variableUpdated","setOptionFromUrl","urlValue","promise","refresh","updateOptions","find","op","defaultText","defaultValue","reduce","acc","item","multi","castArray","setValue","validateVariableSelectionState","firstOption","Promise","resolve","val","map","variableRegex","variableRegexExec","variableString","lastIndex","exec","containsVariable","variableName","args","isString","slice","matches","match","isMatchingVariable","varMatch","indexOf","__WEBPACK_EXTERNAL_MODULE__8__"],"mappings":"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","file":"module.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 53);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","export class OpenNMSHelmAppConfigCtrl {\n  appModel: any;\n  data: any;\n  static templateUrl: string;\n\n  /** @ngInject */\n  constructor() {\n    if (!this.appModel.jsonData) {\n      this.appModel.jsonData = {};\n    }\n    if (!this.appModel.jsonData.actions) {\n      this.appModel.jsonData.actions = [];\n    }\n    this.data = this.appModel.jsonData;\n  }\n\n  addAction() {\n    this.data.actions.push({ url: '' });\n  }\n\n  removeAction(actionIndex: number) {\n    if (this.data.actions[actionIndex]) {\n      console.info('removing action ' + this.data.actions[actionIndex].label + '(' + actionIndex + ')');\n      this.data.actions.splice(actionIndex, 1);\n    } else {\n      console.warn('no action at index ' + actionIndex);\n    }\n  }\n}\n\nOpenNMSHelmAppConfigCtrl.templateUrl = 'components/config.html';\n","import { OpenNMSHelmAppConfigCtrl } from './components/config';\n\nimport { initializeCss } from 'lib/utils';\n\ninitializeCss();\n\nexport { OpenNMSHelmAppConfigCtrl as ConfigCtrl };\n","import { IQService } from 'angular';\nimport _ from 'lodash';\n\nimport { loadPluginCss } from '@grafana/runtime';\n\nlet cssInitialized = false;\nexport function initializeCss() {\n  if (!cssInitialized) {\n    cssInitialized = true;\n    loadPluginCss({\n      dark: 'plugins/opennms-helm-app/styles/dark.css',\n      light: 'plugins/opennms-helm-app/styles/light.css',\n    });\n  }\n}\n\nexport function assignModelProperties(target, source, defaults = {}) {\n  for (const key in defaults) {\n    if (!defaults.hasOwnProperty(key)) {\n      continue;\n    }\n\n    target[key] = source[key] === undefined ? defaults[key] : source[key];\n  }\n}\n\nexport function selectOptionsForCurrentValue(variable) {\n  let i, y, value, option;\n  const selected = [] as any[];\n\n  for (i = 0; i < variable.options.length; i++) {\n    option = variable.options[i];\n    option.selected = false;\n    if (_.isArray(variable.current.value)) {\n      for (y = 0; y < variable.current.value.length; y++) {\n        value = variable.current.value[y];\n        if (option.value === value) {\n          option.selected = true;\n          selected.push(option);\n        }\n      }\n    } else if (option.value === variable.current.value) {\n      option.selected = true;\n      selected.push(option);\n    }\n  }\n\n  return selected;\n}\n\nexport function setOptionAsCurrent(variable, option) {\n  variable.current = _.cloneDeep(option || {});\n\n  if (_.isArray(variable.current.text) && variable.current.text.length > 0) {\n    variable.current.text = variable.current.text.join(' + ');\n  } else if (_.isArray(variable.current.value) && variable.current.value[0] !== '$__all') {\n    variable.current.text = variable.current.value.join(' + ');\n  }\n\n  selectOptionsForCurrentValue(variable);\n  return variableUpdated(variable);\n}\n\nexport function variableUpdated(variable, emitChangeEvents = false) {\n  const $q = variable.$q;\n  const dashboardSrv = variable.dashboardSrv;\n  const templateSrv = variable.templateSrv;\n\n  // if there is a variable lock ignore cascading update because we are in a boot up scenario\n  if (variable.initLock) {\n    return $q.when();\n  }\n\n  const getVariables = templateSrv.getVariables.bind(templateSrv) || dashboardSrv.dashboard.getVariables.bind(dashboardSrv.dashboard);\n  const variables = getVariables();\n  let promises = [] as Array<Promise<any>>;\n\n  // in theory we should create an efficient sub-list of variables to update, but for now just do them all YOLO\n  variables.forEach(v => promises.push(v.updateOptions()));\n\n  templateSrv.setGlobalVariable(variable.id, variable.current);\n\n  return $q.all(promises).then(() => {\n    if (emitChangeEvents) {\n      dashboardSrv.dashboard.templateVariableValueUpdated();\n      dashboardSrv.dashboard.startRefresh();\n    }\n  });\n}\n\n\nexport function setOptionFromUrl(variable: any, urlValue: any, $q: IQService) {\n  let promise = $q.when();\n\n  if (variable.refresh) {\n    promise = variable.updateOptions();\n  }\n\n  return promise.then(() => {\n    // Simple case. Value in url matches existing options text or value.\n    let option = _.find(variable.options, op => {\n      return op.text === urlValue || op.value === urlValue;\n    });\n\n    // No luck either it is array or value does not exist in the variables options.\n    if (!option) {\n      let defaultText = urlValue;\n      const defaultValue = urlValue;\n\n      if (_.isArray(urlValue)) {\n        // Multiple values in the url. We construct text as a list of texts from all matched options.\n        defaultText = urlValue.reduce((acc, item) => {\n          const t = _.find(variable.options, { value: item });\n          if (t) {\n            acc.push(t.text);\n          } else {\n            acc.push(item);\n          }\n\n          return acc;\n        }, []);\n      }\n\n      // It is possible that we did not match the value to any existing option. In that case the url value will be\n      // used anyway for both text and value.\n      option = { text: defaultText, value: defaultValue };\n    }\n\n    if (variable.multi) {\n      // In case variable is multiple choice, we cast to array to preserve the same behaviour as when selecting\n      // the option directly, which will return even single value in an array.\n      option = { text: _.castArray(option.text), value: _.castArray(option.value) };\n    }\n\n    return variable.setValue(option);\n  });\n}\n\nexport function validateVariableSelectionState(variable: any, defaultValue?: any) {\n  if (!variable.current) {\n    variable.current = {};\n  }\n\n  if (_.isArray(variable.current.value)) {\n    let selected = selectOptionsForCurrentValue(variable);\n\n    // if none pick first\n    if (selected.length === 0) {\n      let firstOption = variable.options[0];\n      if (firstOption) {\n        return variable.setValue(firstOption);\n      }\n      return Promise.resolve();\n    } else {\n      let val = {\n        value: _.map(selected, val => {\n          return val.value;\n        }),\n        text: _.map(selected, val => {\n          return val.text;\n        }),\n      };\n      return variable.setValue(val);\n    }\n  } else {\n    let option = undefined;\n\n    // 1. find the current value\n    option = _.find(variable.options, {\n      text: variable.current.text,\n    });\n    if (option) {\n      return variable.setValue(option);\n    }\n\n    // 2. find the default value\n    if (defaultValue) {\n      option = _.find(variable.options, {\n        text: defaultValue,\n      });\n      if (option) {\n        return variable.setValue(option);\n      }\n    }\n\n    // 3. use the first value\n    if (variable.options) {\n      return variable.setValue(variable.options[0]);\n    }\n\n    // 4... give up\n    return Promise.resolve();\n  }\n}\n\nexport const variableRegex = /\\$(\\w+)|\\[\\[([\\s\\S]+?)(?::(\\w+))?\\]\\]|\\${(\\w+)(?:\\.([^:^}]+))?(?::(\\w+))?}/g;\n\nexport const variableRegexExec = (variableString) => {\n  variableRegex.lastIndex = 0;\n  return variableRegex.exec(variableString);\n};\n\nexport function containsVariable(...args) {\n  const variableName = args[args.length - 1];\n  args[0] = _.isString(args[0]) ? args[0] : Object['values'](args[0]).join(' ');\n  const variableString = args.slice(0, -1).join(' ');\n  const matches = variableString.match(variableRegex);\n  const isMatchingVariable =\n    matches !== null\n      ? matches.find(match => {\n          const varMatch = variableRegexExec(match);\n          return varMatch !== null && varMatch.indexOf(variableName) > -1;\n        })\n      : false;\n\n  return !!isMatchingVariable;\n}\n\n","module.exports = __WEBPACK_EXTERNAL_MODULE__8__;"],"sourceRoot":""}