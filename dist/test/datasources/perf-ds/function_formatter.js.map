{"version":3,"sources":["../../../../src/datasources/perf-ds/function_formatter.js"],"names":["FUNCTION_MATCH","ARGUMENT_MATCH","FunctionFormatter","label","match","ret","exec","args","getArguments","push","name","arguments","argsString","trim","length","split","Array","isArray","replacements","func","hasOwnProperty","result","apply","replace","console","warn","metadata","nodeToLabel","nodeCriteria","node","_getNodeFromCriteria","resourceToLabel","criteriaOrResourceId","partialResourceId","resource","_getResource","join","resourceToName","resourceToInterface","nodeId","foreignSource","foreignId","indexOf","parseInt","_getNodeFromMetadata","nodes","filter","undefined","id","resources","_getResourceFromCriteria","resourceCriteria","nodeCriterias","map","c","criteria"],"mappings":"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","file":"function_formatter.js","sourcesContent":["const FUNCTION_MATCH = /(\\w+)\\(([^\\)]*)\\)/g;\nconst ARGUMENT_MATCH = /\\s*,\\s*/;\n\nexport class FunctionFormatter {\n    static findFunctions(label) {\n        let match, ret = [];\n        while ((match = FUNCTION_MATCH.exec(label)) !== null) {\n            const args = FunctionFormatter.getArguments(match[2]);\n            ret.push({\n                name: match[1],\n                arguments: FunctionFormatter.getArguments(match[2])\n            });\n        }\n        return ret;\n    }\n\n    static getArguments(args) {\n        const argsString = args === null? '' : args.trim();\n        if (argsString.length === 0) {\n            return [];\n        }\n        const split = argsString.split(ARGUMENT_MATCH);\n        return Array.isArray(split) ? split : [split];\n    }\n\n    static replace(label, replacements) {\n        let match;\n        let ret = label;\n        while ((match = FUNCTION_MATCH.exec(label)) !== null) {\n            const func = match[1],\n                args = FunctionFormatter.getArguments(match[2]);\n            if (replacements.hasOwnProperty(func)) {\n                const result = replacements[func].apply(replacements[func], args);\n                ret = ret.replace(match[0], result);\n            } else {\n                console.warn('LabelFormatter.replace: unhandled function ' + func);\n            }\n        }\n        return ret;\n    }\n    static format(label, metadata) {\n        return FunctionFormatter.replace(label, {\n            nodeToLabel: (nodeCriteria) => {\n                const node = FunctionFormatter._getNodeFromCriteria(metadata, nodeCriteria);\n                if (node) {\n                    return node.label;\n                }\n                return nodeCriteria;\n            },\n            resourceToLabel: (criteriaOrResourceId, partialResourceId) => {\n                const resource = FunctionFormatter._getResource(metadata, criteriaOrResourceId, partialResourceId);\n                if (resource) {\n                    return resource.label;\n                }\n                return partialResourceId ? [criteriaOrResourceId, partialResourceId].join('.') : criteriaOrResourceId;\n            },\n            resourceToName: (criteriaOrResourceId, partialResourceId) => {\n                const resource = FunctionFormatter._getResource(metadata, criteriaOrResourceId, partialResourceId);\n                if (resource) {\n                    return resource.name;\n                }\n                return partialResourceId ? [criteriaOrResourceId, partialResourceId].join('.') : criteriaOrResourceId;\n            },\n            resourceToInterface: (criteriaOrResourceId, partialResourceId) => {\n                const resource = FunctionFormatter._getResource(metadata, criteriaOrResourceId, partialResourceId);\n                if (resource) {\n                    let match = resource.name.match(/^(\\w+)/);\n                    if (!match) {\n                        match = resource.label.match(/^(\\w+)/);\n                    }\n                    if (match) {\n                        return match[1];\n                    }\n                }\n                return partialResourceId ? [criteriaOrResourceId, partialResourceId].join('.') : criteriaOrResourceId;\n            }\n        });\n    }\n\n    static _getNodeFromCriteria(metadata, nodeCriteria) {\n        let nodeId, foreignSource, foreignId;\n        if (nodeCriteria && nodeCriteria.indexOf(':') > 0) {\n            [foreignSource, foreignId] = nodeCriteria.split(':');\n        } else {\n            nodeId = parseInt(nodeCriteria, 10);\n        }\n        return FunctionFormatter._getNodeFromMetadata(metadata, nodeId, foreignSource, foreignId);\n    }\n\n    static _getNodeFromMetadata(metadata, nodeId, foreignSource, foreignId) {\n        if (metadata && metadata.nodes) {\n            const ret = metadata.nodes.filter((node) => {\n                return (nodeId !== undefined && node.id === nodeId) ||\n                (foreignSource !== undefined && foreignId !== undefined &&\n                    node['foreign-source'] === foreignSource && node['foreign-id'] === foreignId);\n            })[0];\n            if (ret !== undefined) {\n                return ret;\n            }\n        }\n        //console.warn('Unable to locate node ' + [nodeId, foreignSource, foreignId].join(',') + ' in metadata.', metadata);\n        return null;\n    }\n\n    static _getResource(metadata, criteriaOrResourceId, partialResourceId) {\n        if (partialResourceId === undefined) {\n            for (const resource of metadata.resources) {\n                if (resource.id === criteriaOrResourceId) {\n                    return resource;\n                }\n            }\n        } else {\n            const node = FunctionFormatter._getNodeFromCriteria(metadata, criteriaOrResourceId);\n            if (node) {\n                const resource = FunctionFormatter._getResourceFromCriteria(metadata, partialResourceId, 'node[' + node['foreign-source'] + ':' + node['foreign-id'] + ']', 'node[' + node.id + ']');\n                if (resource) {\n                    return resource;\n                }\n            }\n        }\n        //console.warn('Unable to locate resource ' + [criteriaOrResourceId,partialResourceId].join('.') + ' in metadata.', metadata);\n        return null;\n    }\n\n    static _getResourceFromCriteria(metadata, resourceCriteria, ...nodeCriterias) {\n        if (metadata && metadata.resources) {\n            const ret = metadata.resources.filter((resource) => {\n                if (resource.id === resourceCriteria) return true;\n                for (const criteria of nodeCriterias.map(c => c + '.' + resourceCriteria)) {\n                    if (resource.id === criteria) {\n                        return true;\n                    }\n                }\n                return false;\n            })[0];\n            if (ret !== undefined) {\n                return ret;\n            }\n        }\n        //console.warn('Unable to locate resource ' + resourceCriteria + ' in metadata.', metadata);\n        return null;\n    }\n}"]}