{"version":3,"sources":["../../../../src/panels/alarm-table/selection_mgr.js"],"names":["SelectionMgr","getRowsInRange","onSelectionChangeCallback","clearSelectedRows","_selectedRows","Set","_lastSelectedRow","undefined","row","exclusiveModifier","rangeModifier","selectedRows","size","isEqual","handleSelection","selectedRow","Array","from","add","filter","r","alarmId","selectionRows","didSelectionChange","rowsToAddToSelection","isRowSelected","selectionRow","rowsToRemoveFromSelection","getSelectedRows","findIndex","length","each","addRowToSelection","rowToAddToSelection","selected","removeRowFromSelection"],"mappings":"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","file":"selection_mgr.js","sourcesContent":["import _ from 'lodash';\n\nexport class SelectionMgr {\n\n  constructor(getRowsInRange, onSelectionChangeCallback) {\n    this.clearSelectedRows();\n    this.getRowsInRange = getRowsInRange;\n    this.onSelectionChangeCallback = onSelectionChangeCallback;\n  }\n\n  clearSelectedRows() {\n    this._selectedRows = new Set();\n    this._lastSelectedRow = undefined;\n  }\n\n  handleRowClick(row, exclusiveModifier, rangeModifier) {\n    let selectedRows;\n    if (!rangeModifier && !exclusiveModifier && this._selectedRows.size === 1 && this._lastSelectedRow && _.isEqual(this._lastSelectedRow, row)) {\n      selectedRows = new Set();\n    } else if (!rangeModifier || this._lastSelectedRow === undefined) {\n      // No other row was previously selected, use the row that was clicked on\n      selectedRows = [row];\n    } else {\n      // Build the list of rows between the last row that was clicked\n      // and the current row\n      selectedRows = this.getRowsInRange(this._lastSelectedRow, row);\n    }\n    this.handleSelection(selectedRows, exclusiveModifier);\n  }\n\n  isRowSelected(row) {\n    for (let selectedRow of this._selectedRows) {\n      if (_.isEqual(selectedRow, row)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  getSelectedRows() {\n    return Array.from(this._selectedRows);\n  }\n\n  addRowToSelection(row) {\n    this._selectedRows.add(row);\n    this._lastSelectedRow = row;\n  }\n\n  removeRowFromSelection(row) {\n    this._selectedRows = new Set(Array.from(this._selectedRows).filter((r) => r.alarmId !== row.alarmId ));\n    this._lastSelectedRow = this._selectedRows[0];\n  }\n\n  handleSelection(selectionRows, exclusiveModifier) {\n    let didSelectionChange = false;\n    if (!exclusiveModifier) {\n      // Determine the rows we need to add to the selection\n      let rowsToAddToSelection = _.filter(selectionRows, selectionRow => !this.isRowSelected(selectionRow));\n\n      // Determine the rows we need to remove from the selection\n      let rowsToRemoveFromSelection = _.filter(this.getSelectedRows(), selectedRow => {\n        return _.findIndex(selectionRows, selectionRow => _.isEqual(selectedRow, selectionRow)) < 0;\n      });\n\n      if (rowsToRemoveFromSelection.length > 0) {\n        // Clear everything and add all the selected rows\n        this.clearSelectedRows();\n        _.each(selectionRows, selectionRow => this.addRowToSelection(selectionRow));\n        didSelectionChange = true;\n      } else if (rowsToAddToSelection.length > 0) {\n        // Add the selected rows\n        _.each(rowsToAddToSelection, rowToAddToSelection =>  this.addRowToSelection(rowToAddToSelection));\n        didSelectionChange = true;\n      }\n    } else {\n      const selected = this.isRowSelected(selectionRows[selectionRows.length - 1]);\n      // Add the rows to the current selection\n      _.each(selectionRows, selectionRow => {\n        if (selected) {\n          this.removeRowFromSelection(selectionRow);\n          didSelectionChange = true;\n        } else {\n          this.addRowToSelection(selectionRow);\n          didSelectionChange = true;\n        }\n      });\n    }\n\n    if (didSelectionChange && this.onSelectionChangeCallback) {\n      this.onSelectionChangeCallback();\n    }\n  }\n}\n"]}