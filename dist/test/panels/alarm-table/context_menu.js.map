{"version":3,"sources":["../../../../src/panels/alarm-table/context_menu.js"],"names":["contextMenuAsDirective","$parse","$q","_contextMenus","_clickedElement","DEFAULT_ITEM_TEXT","createAndAddOptionText","params","$scope","item","event","modelValue","$promises","nestedMenu","$li","leftOriented","String","orientation","toLowerCase","optionText","html","angular","isFunction","$a","$","$anchorStyle","textAlign","paddingLeft","paddingRight","css","attr","tabindex","href","textParam","text","call","$promise","when","push","then","pText","$arrow","$boldStyle","fontFamily","fontWeight","float","$bold","append","processItem","extractNestedMenu","currItemParam","extend","enabled","isOptionEnabled","registerCurrentItemEvents","$ul","level","openNestedMenu","$event","removeContextMenus","ev","pageX","offsetWidth","pageY","offsetTop","view","window","target","promisedNestedMenu","nestedParam","renderContextMenu","on","which","preventDefault","$apply","currentTarget","removeClass","removeAllContextMenus","clickFunction","click","addClass","children","isArray","options","initContextMenuContainer","forEach","itemParams","document","find","doAfterAllPromises","all","topCoordinate","menuHeight","element","prop","winHeight","scrollY","innerHeight","offsetHeight","reduceThresholdY","leftCoordinate","menuWidth","winWidth","innerWidth","padding","reduceThresholdX","display","position","left","top","customClass","isTouchDevice","navigator","maxTouchPoints","length","pop","remove","removeOnScrollEvent","e","removeOnOutsideClickEvent","$curr","shouldRemove","hasClass","parent","body","off","attrs","openMenuEvent","contextMenuOn","allowEventPropagation","stopPropagation","$eval","contextMenu","contextMenuClass","model","contextMenuOrientation","Array","$on"],"mappings":"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","file":"context_menu.js","sourcesContent":["/*\nThe MIT License (MIT)\n\nCopyright (c) 2014 Austin Andrews (@templarian)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n\nThis is based on the context menu code available here:\n https://github.com/Templarian/ui.bootstrap.contextMenu/blob/6f8d787726019ef9e814fbfbd986f10aaf74eddd/contextMenu.js\n*/\n\n/** @ngInject */\nexport function contextMenuAsDirective() {\n  'use strict';\n  return [\"$parse\", \"$q\", function ($parse, $q) {\n\n    var _contextMenus = [];\n    // Contains the element that was clicked to show the context menu\n    var _clickedElement = null;\n    var DEFAULT_ITEM_TEXT = \"New Item\";\n\n    function createAndAddOptionText(params) {\n      // Destructuring:\n      var $scope = params.$scope;\n      var item = params.item;\n      var event = params.event;\n      var modelValue = params.modelValue;\n      var $promises = params.$promises;\n      var nestedMenu = params.nestedMenu;\n      var $li = params.$li;\n      var leftOriented = String(params.orientation).toLowerCase() === 'left';\n\n      var optionText = null;\n\n      if (item.html) {\n        if (angular.isFunction(item.html)) {\n          // runs the function that expects a jQuery/jqLite element\n          optionText = item.html($scope);\n        } else {\n          // Assumes that the developer already placed a valid jQuery/jqLite element\n          optionText = item.html;\n        }\n      } else {\n\n        var $a = $('<a>');\n        var $anchorStyle = {};\n\n        if (leftOriented) {\n          $anchorStyle.textAlign = 'right';\n          $anchorStyle.paddingLeft = \"8px\";\n        } else {\n          $anchorStyle.textAlign = 'left';\n          $anchorStyle.paddingRight = \"8px\";\n        }\n\n        $a.css($anchorStyle);\n        $a.attr({ tabindex: '-1', href: '#' });\n\n        var textParam = item[0];\n        var text = DEFAULT_ITEM_TEXT;\n\n        if (typeof textParam === 'string') {\n          text = textParam;\n        } else if (typeof textParam === \"function\") {\n          text = textParam.call($scope, $scope, event, modelValue);\n        } else if (typeof item.text !== \"undefined\") {\n          text = item.text;\n        }\n\n        var $promise = $q.when(text);\n        $promises.push($promise);\n        $promise.then(function (pText) {\n          if (nestedMenu) {\n            var $arrow;\n            var $boldStyle = {\n              fontFamily: 'monospace',\n              fontWeight: 'bold'\n            };\n\n            if (leftOriented) {\n              $arrow = '&lt;';\n              $boldStyle.float = 'left';\n            } else {\n              $arrow = '&gt;';\n              $boldStyle.float = 'right';\n            }\n\n            var $bold = $('<strong style=\"font-family:monospace;font-weight:bold;float:right;\">' + $arrow + '</strong>');\n            $bold.css($boldStyle);\n            $a.css(\"cursor\", \"default\");\n            $a.append($bold);\n          }\n          $a.append(pText);\n        });\n\n        optionText = $a;\n      }\n\n      $li.append(optionText);\n    }\n\n    /**\n     * Process each individual item\n     *\n     * Properties of params:\n     * - $scope\n     * - event\n     * - modelValue\n     * - level\n     * - item\n     * - $ul\n     * - $li\n     * - $promises\n     */\n    function processItem(params) {\n      var nestedMenu = extractNestedMenu(params);\n\n      // if html property is not defined, fallback to text, otherwise use default text\n      // if first item in the item array is a function then invoke .call()\n      // if first item is a string, then text should be the string.\n\n      var currItemParam = angular.extend({}, params);\n      currItemParam.nestedMenu = nestedMenu;\n      currItemParam.enabled = isOptionEnabled(currItemParam);\n      currItemParam.text = createAndAddOptionText(currItemParam);\n\n      registerCurrentItemEvents(currItemParam);\n\n    }\n\n    /*\n     * Registers the appropriate mouse events for options if the item is enabled.\n     * Otherwise, it ensures that clicks to the item do not propagate.\n     */\n    function registerCurrentItemEvents (params) {\n      // Destructuring:\n      var item = params.item;\n      var $ul = params.$ul;\n      var $li = params.$li;\n      var $scope = params.$scope;\n      var modelValue = params.modelValue;\n      var level = params.level;\n      var event = params.event;\n      var text = params.text;\n      var nestedMenu = params.nestedMenu;\n      var enabled = params.enabled;\n      var orientation = String(params.orientation).toLowerCase();\n\n      if (enabled) {\n        var openNestedMenu = function ($event) {\n          removeContextMenus(level + 1);\n          /*\n           * The object here needs to be constructed and filled with data\n           * on an \"as needed\" basis. Copying the data from event directly\n           * or cloning the event results in unpredictable behavior.\n           */\n          /// adding the original event in the object to use the attributes of the mouse over event in the promises\n          var ev = {\n            pageX: orientation === 'left' ? event.pageX - $ul[0].offsetWidth + 1 : event.pageX + $ul[0].offsetWidth - 1,\n            pageY: $ul[0].offsetTop + $li[0].offsetTop - 3,\n            view: event.view || window,\n            target: event.target,\n            event: $event\n          };\n\n          /*\n           * At this point, nestedMenu can only either be an Array or a promise.\n           * Regardless, passing them to `when` makes the implementation singular.\n           */\n          $q.when(nestedMenu).then(function(promisedNestedMenu) {\n            var nestedParam = {\n              \"$scope\" : $scope,\n              \"event\" : ev,\n              \"options\" : promisedNestedMenu,\n              \"modelValue\" : modelValue,\n              \"level\" : level + 1,\n              \"orientation\": orientation\n            };\n            renderContextMenu(nestedParam);\n          });\n        };\n\n        $li.on('click', function ($event) {\n          if($event.which == 1) {\n            $event.preventDefault();\n            $scope.$apply(function () {\n              $(event.currentTarget).removeClass('context');\n              removeAllContextMenus();\n\n              var clickFunction = angular.isFunction(item.click)\n                ? item.click\n                : (angular.isFunction(item[1])\n                  ? item[1]\n                  : null);\n\n              if (clickFunction) {\n                clickFunction.call($scope, $scope, event, modelValue, text, $li);\n              }\n            });\n          }\n        });\n\n        $li.on('mouseover', function ($event) {\n          $scope.$apply(function () {\n            if (nestedMenu) {\n              openNestedMenu($event);\n            } else {\n              removeContextMenus(level + 1);\n            }\n          });\n        });\n      } else {\n        $li.on('click', function ($event) {\n          $event.preventDefault();\n        });\n        $li.addClass('disabled');\n      }\n    }\n\n    /**\n     * @param params - an object containing the `item` parameter\n     * @returns an Array or a Promise containing the children,\n     *          or null if the option has no submenu\n     */\n    function extractNestedMenu(params) {\n      // Destructuring:\n      var item = params.item;\n\n      // New implementation:\n      if (item.children) {\n        if (angular.isFunction(item.children)) {\n          // Expects a function that returns a Promise or an Array\n          return item.children();\n        } else if (angular.isFunction(item.children.then) || angular.isArray(item.children)) {\n          // Returns the promise\n          // OR, returns the actual array\n          return item.children;\n        }\n\n        return null;\n\n      } else {\n        // nestedMenu is either an Array or a Promise that will return that array.\n        // NOTE: This might be changed soon as it's a hangover from an old implementation\n\n        return angular.isArray(item[1]) ||\n        (item[1] && angular.isFunction(item[1].then)) ? item[1] : angular.isArray(item[2]) ||\n        (item[2] && angular.isFunction(item[2].then)) ? item[2] : angular.isArray(item[3]) ||\n        (item[3] && angular.isFunction(item[3].then)) ? item[3] : null;\n      }\n    }\n\n    /**\n     * Responsible for the actual rendering of the context menu.\n     *\n     * The parameters in params are:\n     * - $scope = the scope of this context menu\n     * - event = the event that triggered this context menu\n     * - options = the options for this context menu\n     * - modelValue = the value of the model attached to this context menu\n     * - level = the current context menu level (defauts to 0)\n     * - customClass = the custom class to be used for the context menu\n     */\n    function renderContextMenu (params) {\n      /// <summary>Render context menu recursively.</summary>\n\n      // Destructuring:\n      var options = params.options;\n      /*\n      var $scope = params.$scope;\n      var event = params.event;\n      var modelValue = params.modelValue;\n      var level = params.level;\n      var customClass = params.customClass;\n      */\n\n      // Initialize the container. This will be passed around\n      var $ul = initContextMenuContainer(params);\n      params.$ul = $ul;\n\n      // Register this level of the context menu\n      _contextMenus.push($ul);\n\n      /*\n       * This object will contain any promises that we have\n       * to wait for before trying to adjust the context menu.\n       */\n      var $promises = [];\n      params.$promises = $promises;\n\n      angular.forEach(options, function (item) {\n        var $li = $('<li>');\n        if (item === null) {\n          $li.addClass('divider');\n        } else if (typeof item[0] === \"object\") {\n          //custom.initialize($li, item);\n        } else {\n          var itemParams = angular.extend({}, params);\n          itemParams.item = item;\n          itemParams.$li = $li;\n          processItem(itemParams);\n        }\n        $ul.append($li);\n      });\n\n      $(document).find('body').append($ul);\n\n      doAfterAllPromises(params);\n    }\n\n    /**\n     * calculate if drop down menu would go out of screen at left or bottom\n     * calculation need to be done after element has been added (and all texts are set; thus the promises)\n     * to the DOM the get the actual height\n     */\n    function doAfterAllPromises (params) {\n\n      // Desctructuring:\n      var $ul = params.$ul;\n      var $promises = params.$promises;\n      var level = params.level;\n      var event = params.event;\n      var leftOriented = String(params.orientation).toLowerCase() === 'left';\n\n      $q.all($promises).then(function () {\n        var topCoordinate  = event.pageY;\n        var menuHeight = angular.element($ul[0]).prop('offsetHeight');\n        var winHeight = window.scrollY + event.view.innerHeight;\n        /// the 20 pixels in second condition are considering the browser status bar that sometimes overrides the element\n        if (topCoordinate > menuHeight && winHeight - topCoordinate < menuHeight + 20) {\n          topCoordinate = event.pageY - menuHeight;\n          /// If the element is a nested menu, adds the height of the parent li to the topCoordinate to align with the parent\n          if(level && level > 0) {\n            topCoordinate += event.event.currentTarget.offsetHeight;\n          }\n        } else if(winHeight <= menuHeight) {\n          // If it really can't fit, reset the height of the menu to one that will fit\n          angular.element($ul[0]).css({\"height\": winHeight - 5, \"overflow-y\": \"scroll\"});\n          // ...then set the topCoordinate height to 0 so the menu starts from the top\n          topCoordinate = 0;\n        } else if(winHeight - topCoordinate < menuHeight) {\n          var reduceThresholdY = 5;\n          if(topCoordinate < reduceThresholdY) {\n            reduceThresholdY = topCoordinate;\n          }\n          topCoordinate = winHeight - menuHeight - reduceThresholdY;\n        }\n\n        var leftCoordinate = event.pageX;\n        var menuWidth = angular.element($ul[0]).prop('offsetWidth');\n        var winWidth = event.view.innerWidth;\n        var padding = 5;\n\n        if (leftOriented) {\n          if (winWidth - leftCoordinate > menuWidth && leftCoordinate < menuWidth + padding) {\n            leftCoordinate = padding;\n          } else if (leftCoordinate < menuWidth) {\n            let reduceThresholdX = 5;\n            if (winWidth - leftCoordinate < reduceThresholdX + padding) {\n              reduceThresholdX = winWidth - leftCoordinate + padding;\n            }\n            leftCoordinate = menuWidth + reduceThresholdX + padding;\n          } else {\n            leftCoordinate = leftCoordinate - menuWidth;\n          }\n        } else {\n          if (leftCoordinate > menuWidth && winWidth - leftCoordinate - padding < menuWidth) {\n            leftCoordinate = winWidth - menuWidth - padding;\n          } else if(winWidth - leftCoordinate < menuWidth) {\n            let reduceThresholdX = 5;\n            if(leftCoordinate < reduceThresholdX + padding) {\n              reduceThresholdX = leftCoordinate + padding;\n            }\n            leftCoordinate = winWidth - menuWidth - reduceThresholdX - padding;\n          }\n        }\n\n        $ul.css({\n          display: 'block',\n          position: 'absolute',\n          left: leftCoordinate + 'px',\n          top: topCoordinate + 'px'\n        });\n      });\n\n    }\n\n    /**\n     * Creates the container of the context menu (a <ul> element),\n     * applies the appropriate styles and then returns that container\n     *\n     * @return a <ul> jqLite/jQuery element\n     */\n    function initContextMenuContainer(params) {\n      // Destructuring\n      var customClass = params.customClass;\n\n      var $ul = $('<ul>');\n      $ul.addClass('dropdown-menu');\n      $ul.attr({ 'role': 'menu' });\n      $ul.css({\n        display: 'block',\n        position: 'absolute',\n        left: params.event.pageX + 'px',\n        top: params.event.pageY + 'px',\n        \"z-index\": 10000\n      });\n\n      if(customClass) { $ul.addClass(customClass); }\n\n      return $ul;\n    }\n\n    // if item is object, and has enabled prop invoke the prop\n    // else if fallback to item[2]\n    function isOptionEnabled (params) {\n      var item = params.item;\n      var $scope = params.$scope;\n      var event = params.event;\n      var modelValue = params.modelValue;\n      var text = params.text;\n\n      if (typeof item.enabled !== \"undefined\") {\n        return item.enabled.call($scope, $scope, event, modelValue, text);\n      } else if (typeof item[2] === \"function\") {\n        return item[2].call($scope, $scope, event, modelValue, text);\n      } else {\n        return true;\n      }\n    }\n\n    function isTouchDevice() {\n      return 'ontouchstart' in window  || navigator.maxTouchPoints; // works on most browsers | works on IE10/11 and Surface\n    }\n\n    /**\n     * Removes the context menus with level greater than or equal\n     * to the value passed. If undefined, null or 0, all context menus\n     * are removed.\n     */\n    function removeContextMenus (level) {\n      while (_contextMenus.length && (!level || _contextMenus.length > level)) {\n        _contextMenus.pop().remove();\n      }\n    }\n\n    function removeOnScrollEvent(e) {\n      removeAllContextMenus(e);\n    }\n\n    function removeOnOutsideClickEvent(e) {\n\n      var $curr = $(e.target);\n      var shouldRemove = true;\n\n      while($curr.length) {\n        if($curr.hasClass(\"dropdown-menu\")) {\n          shouldRemove = false;\n          break;\n        } else {\n          $curr = $curr.parent();\n        }\n      }\n      if (shouldRemove) {\n        removeAllContextMenus(e);\n      }\n    }\n\n    function removeAllContextMenus() {\n      $(document.body).off('mousedown', removeOnOutsideClickEvent);\n      $(document).off('scroll', removeOnScrollEvent);\n      $(_clickedElement).removeClass('context');\n      removeContextMenus();\n    }\n\n    return function ($scope, element, attrs) {\n      var openMenuEvent = \"contextmenu\";\n      if(attrs.contextMenuOn && typeof(attrs.contextMenuOn) === \"string\"){\n        openMenuEvent = attrs.contextMenuOn;\n      }\n      element.on(openMenuEvent, function (event) {\n        if(!attrs.allowEventPropagation) {\n          event.stopPropagation();\n          event.preventDefault();\n        }\n\n        // Don't show context menu if on touch device and element is draggable\n        if(isTouchDevice() && element.attr('draggable') === 'true') {\n          return false;\n        }\n\n        // Remove if the user clicks outside\n        $(document.body).on('mousedown', removeOnOutsideClickEvent);\n        // Remove the menu when the scroll moves\n        $(document).on('scroll', removeOnScrollEvent);\n\n        _clickedElement = event.currentTarget;\n        $(_clickedElement).addClass('context');\n\n        $scope.$apply(function () {\n          $scope.$event = event;\n          var options = $scope.$eval(attrs.contextMenu);\n          var customClass = attrs.contextMenuClass;\n          var modelValue = $scope.$eval(attrs.model);\n          var orientation = attrs.contextMenuOrientation;\n\n          var params = {\n            \"$scope\" : $scope,\n            \"event\" : event,\n            \"options\" : options,\n            \"modelValue\" : modelValue,\n            \"level\" : 0,\n            \"customClass\" : customClass,\n            \"orientation\": orientation\n          };\n\n          if (options instanceof Array) {\n            if (options.length === 0) { return; }\n            renderContextMenu(params);\n          } else {\n            throw '\"' + attrs.contextMenu + '\" not an array';\n          }\n        });\n\n        // Remove all context menus if the scope is destroyed\n        $scope.$on(\"$destroy\", function () {\n          removeAllContextMenus();\n        });\n      });\n    };\n  }];\n}\n\n"]}