{"version":3,"sources":["../../src/spec/alarm_table_transformers_spec.js"],"names":["transformers","TableModel","describe","transformer","beforeEach","it","expect","getColumns","to","have","length","table","columns","eql","t1","t2","push","row","rows","panel","model","transform","actualRow","metadata","meta","expectedRow","undefined","alarm_from_ds1_as_row","source","alarm","id","alarm_from_ds2_as_row"],"mappings":"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","file":"alarm_table_transformers_spec.js","sourcesContent":["import {transformers} from '../panels/alarm-table/transformers';\nimport {TableModel} from '../panels/alarm-table/table_model';\n\ndescribe('Table transformer', function() {\n  let transformer;\n\n  beforeEach(function() {\n    transformer = transformers['table'];\n  });\n\n  describe('Listing the columns', function() {\n    it('should return an empty list of columns when no data is present', function() {\n      expect(transformer.getColumns([])).to.have.length(0);\n    });\n\n    it('should return an empty list of columns when the given table has no columns', function() {\n      let table = new TableModel();\n      expect(transformer.getColumns([table])).to.have.length(0);\n    });\n\n    it('should return the list of columns when a table has columns', function() {\n      let table = new TableModel();\n      table.columns = ['col1', 'col2', 'col3'];\n      expect(transformer.getColumns([table])).to.eql(['col1', 'col2', 'col3']);\n    });\n\n    it('should return the intersection of all columns names when given multiple tables', function() {\n      let t1 = new TableModel();\n      t1.columns = ['col1', 'col2', 'col3'];\n      let t2 = new TableModel();\n      t2.columns = ['col1', 'col2', 'colx'];\n      expect(transformer.getColumns([t1,t2])).to.eql(['col1', 'col2']);\n    });\n  });\n\n  describe('Transforming the data', function() {\n    it('should return all columns if none are specified in the panel definition', function() {\n      let table = new TableModel();\n      table.columns.push(\"A\");\n\n      let row = [1];\n      table.rows.push(row);\n\n      let panel = {};\n      let model = new TableModel();\n\n      transformer.transform([table], panel, model);\n      expect(model.columns).to.eql(table.columns);\n      expect(model.rows).to.eql(table.rows);\n    });\n\n    it('should filter the columns if one or more are specified in the panel definition', function() {\n      let table = new TableModel();\n      table.columns.push('A', 'B', 'C');\n\n      let actualRow = [1,2,3];\n      let metadata = {\n        'alarm': 'abc'\n      };\n      actualRow.meta = metadata;\n      table.rows.push(actualRow);\n\n      let panel = {columns: [{\n        'text': 'B'\n      }]};\n      let model = new TableModel();\n\n      transformer.transform([table], panel, model);\n\n      // The meta-data that was on the original row should also be present on the\n      // transformed row\n      let expectedRow = [2];\n      expectedRow.meta = metadata;\n\n      expect(model.columns).to.eql(panel.columns);\n      expect(model.rows).to.eql([expectedRow]);\n    });\n\n    it('should re-order the columns according the order specified in the panel definition', function() {\n      let table = new TableModel();\n      table.columns.push('A', 'B', 'C');\n      table.rows.push([1,2,3]);\n\n      let panel = {columns: [{\n        'text': 'C'\n      }, {\n        'text': 'B'\n      }]};\n      let model = new TableModel();\n\n      transformer.transform([table], panel, model);\n\n      expect(model.columns).to.eql(panel.columns);\n      expect(model.rows).to.eql([[3, 2]]);\n    });\n\n    it('should use an undefined value when a column is present in the panel definition, but not in any of the tables', function() {\n      let table = new TableModel();\n      table.columns.push('A', 'B', 'C');\n      table.rows.push([1,2,3]);\n\n      let panel = {columns: [{\n        'text': 'C'\n      }, {\n        'text': 'Z'\n      }, {\n        'text': 'B'\n      }]};\n      let model = new TableModel();\n\n      transformer.transform([table], panel, model);\n\n      expect(model.columns).to.eql(panel.columns);\n      expect(model.rows).to.eql([[3, undefined, 2]]);\n    });\n\n    it('should combine multiple tables into a single table', function() {\n      let t1 = new TableModel();\n      t1.columns.push(\"A\");\n      t1.rows.push([1]);\n\n      let t2 = new TableModel();\n      t2.columns.push(\"A\");\n      t2.rows.push([2]);\n\n      let panel = {};\n      let model = new TableModel();\n\n      transformer.transform([t1,t2], panel, model);\n      expect(model.columns).to.eql(t1.columns);\n      expect(model.rows).to.eql([[1], [2]]);\n    });\n\n    it('should deduplicate alarms originating from the same datasource', function() {\n      let alarm_from_ds1_as_row = [1];\n      alarm_from_ds1_as_row.meta = {\n        source: 'ds1',\n        alarm: {\n          id: 1\n        }\n      };\n\n      let alarm_from_ds2_as_row = [2];\n      alarm_from_ds2_as_row.meta = {\n        source: 'ds2',\n        alarm: {\n          id: 1\n        }\n      };\n\n      let t1 = new TableModel();\n      t1.columns.push(\"ID\");\n      t1.rows.push(alarm_from_ds1_as_row);\n\n      let t2 = new TableModel();\n      t2.columns.push(\"ID\");\n      t2.rows.push(alarm_from_ds1_as_row);\n      t2.rows.push(alarm_from_ds2_as_row);\n\n      let panel = {};\n      let model = new TableModel();\n\n      transformer.transform([t1,t2], panel, model);\n      expect(model.columns).to.eql(t1.columns);\n      // alarm_from_ds1_as_row should only appear once\n      expect(model.rows).to.eql([alarm_from_ds1_as_row, alarm_from_ds2_as_row]);\n    });\n  });\n\n});"]}