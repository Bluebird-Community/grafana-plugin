{"version":3,"sources":["../../src/spec/perf_ds_datasource_spec.js"],"names":["Datasource","Q","describe","ctx","beforeEach","$q","backendSrv","templateSrv","replace","val","containsVariable","ds","url","query","range","from","to","targets","type","nodeId","resourceId","attribute","aggregation","interval","response","it","done","datasourceRequest","request","when","_request","status","data","then","result","expect","have","length","target","equal","datapoints","NaN","testDatasource","variables","name","current","value","options","buildQuery","source","scopedVars","label","filter","filterParameters","param1","param2","parameter","key","labels","deep"],"mappings":"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","file":"perf_ds_datasource_spec.js","sourcesContent":["import {Datasource} from \"../datasources/perf-ds/module\";\nimport Q from \"q\";\n\ndescribe('OpenNMSPMDatasource', function () {\n  let ctx = {};\n\n  beforeEach(function () {\n    ctx.$q = Q;\n    ctx.backendSrv = {};\n    ctx.templateSrv = {replace: val => val, containsVariable: () => true};\n    ctx.ds = new Datasource({url: ''}, ctx.$q, ctx.backendSrv, ctx.templateSrv);\n  });\n\n  describe('querying with one target', function () {\n    let query = {\n      range: {from: 'now-1h', to: 'now'},\n      targets: [{\n        type: \"attribute\",\n        nodeId: '1',\n        resourceId: 'nodeSnmp[]',\n        attribute: 'loadavg1',\n        aggregation: 'AVERAGE'\n      }],\n      interval: '1s'\n    };\n\n    let response = {\n      \"step\": 300000,\n      \"start\": 1424211730000,\n      \"end\": 1424226130000,\n      \"timestamps\": [1424211730001],\n      \"labels\": [\"loadavg1\"],\n      \"columns\": [\n        {\n          \"values\": [5.0]\n        }\n      ]\n    };\n\n    it('should return a list of series', function (done) {\n      ctx.backendSrv.datasourceRequest = function (request) {\n        return ctx.$q.when({\n          _request: request,\n          status: 200,\n          data: response\n        });\n      };\n\n      ctx.ds.query(query).then(function (result) {\n        expect(result.data).to.have.length(1);\n        expect(result.data[0].target).to.equal('loadavg1');\n        expect(result.data[0].datapoints).to.have.length(1);\n        done();\n      });\n    });\n  });\n\n  describe('relaxed mode', function () {\n    let query = {\n      range: {from: 'now-1h', to: 'now'},\n      targets: [{\n        type: \"attribute\",\n        nodeId: '1',\n        resourceId: 'nodeSnmp[]',\n        attribute: 'does-not-exist',\n        aggregation: 'AVERAGE'\n      }],\n      interval: '1s'\n    };\n\n    let response = {\n      \"step\": 300000,\n      \"start\": 1424211730000,\n      \"end\": 1424226130000,\n      \"timestamps\": [1424211730001],\n      \"labels\": [\"loadavg1\"],\n      \"columns\": [\n        {\n          \"values\": [NaN]\n        }\n      ]\n    };\n\n    it('should filter series that contain only NaNs', function (done) {\n      ctx.backendSrv.datasourceRequest = function (request) {\n        return ctx.$q.when({\n          _request: request,\n          status: 200,\n          data: response\n        });\n      };\n\n      ctx.ds.query(query).then(function (result) {\n        expect(result.data).to.have.length(0);\n        done();\n      });\n    });\n  });\n\n  describe('testing for connectivity', function () {\n    it('should make a request to /rest/info', function (done) {\n      ctx.backendSrv.datasourceRequest = function (request) {\n        expect(request.url).to.equal('/rest/info');\n        return ctx.$q.when({\n          status: 200\n        });\n      };\n\n      ctx.ds.testDatasource().then(function () {\n        done();\n      });\n    });\n  });\n\n  describe('using templates', function () {\n    it('should perform simple variable substitution', function () {\n      ctx.templateSrv.variables = [\n        {name: 'variable', current: {value: 'loadavg1'}}\n      ];\n\n      let options = {\n        range: {from: 'now-1h', to: 'now'},\n        targets: [{\n          type: \"attribute\",\n          nodeId: '1',\n          resourceId: 'nodeSnmp[]',\n          attribute: '$variable',\n          aggregation: 'AVERAGE'\n        }],\n        interval: '1s'\n      };\n      let [query,] = ctx.ds.buildQuery(options);\n\n      expect(query.source.length).to.equal(1);\n      expect(query.source[0].attribute).to.equal(\"loadavg1\");\n    });\n\n    it('should support scoped variables', function () {\n      ctx.templateSrv.variables = [\n        {name: 'variable', current: {value: 'loadavg1'}}\n      ];\n\n      let options = {\n        range: {from: 'now-1h', to: 'now'},\n        targets: [{\n          type: \"attribute\",\n          nodeId: '1',\n          resourceId: 'nodeSnmp[]',\n          attribute: '$variable',\n          aggregation: 'AVERAGE'\n        }],\n        interval: '1s',\n        scopedVars: {\n          'variable': {\n            value: 'loadavg5'\n          }\n        }\n      };\n      let [query,] = ctx.ds.buildQuery(options);\n\n      expect(query.source.length).to.equal(1);\n      expect(query.source[0].attribute).to.equal(\"loadavg5\");\n    });\n\n    it('should use node[] or nodeSource[] based on the contents of the variable', function () {\n      ctx.templateSrv.variables = [\n        {name: 'node', current: {value: ['1', 'FS:FID']}}\n      ];\n\n      let options = {\n        range: {from: 'now-1h', to: 'now'},\n        targets: [{\n          type: \"attribute\",\n          nodeId: '$node',\n          resourceId: 'nodeSnmp[]',\n          attribute: 'CpuRawIdle',\n          aggregation: 'AVERAGE',\n          label: 'idle on $node'\n        }],\n        interval: '1s'\n      };\n      let [query,] = ctx.ds.buildQuery(options);\n\n      expect(query.source.length).to.equal(2);\n      expect(query.source[0].resourceId).to.equal(\"node[1].nodeSnmp[]\");\n      expect(query.source[1].resourceId).to.equal(\"nodeSource[FS:FID].nodeSnmp[]\");\n    });\n\n    it('should generate multiple sources for multi-valued template variables', function () {\n      ctx.templateSrv.variables = [\n        {name: 'v1', current: {value: ['1', '2']}},\n        {name: 'v2', current: {value: ['x', 'y']}}\n      ];\n\n      let options = {\n        range: {from: 'now-1h', to: 'now'},\n        targets: [{\n          type: \"attribute\",\n          nodeId: '1',\n          resourceId: 'nodeSnmp[]',\n          attribute: '$v1-$v2',\n          aggregation: 'AVERAGE'\n        }],\n        interval: '1s'\n      };\n      let [query,] = ctx.ds.buildQuery(options);\n\n      expect(query.source.length).to.equal(4);\n      expect(query.source[0].attribute).to.equal(\"1-x\");\n      expect(query.source[1].attribute).to.equal(\"1-y\");\n      expect(query.source[2].attribute).to.equal(\"2-x\");\n      expect(query.source[3].attribute).to.equal(\"2-y\");\n    });\n\n    it('should handle substituting \"All\" with all of the available values', function () {\n      ctx.templateSrv.variables = [\n        {\n          name: 'x',\n          current: {value: ['$__all']},\n          options: [\n            {value: '$__all'},\n            {value: 'a'},\n            {value: 'b'},\n            {value: 'c'},\n            {value: 'd'}\n          ]\n        }\n      ];\n\n      let options = {\n        range: {from: 'now-1h', to: 'now'},\n        targets: [{\n          type: \"attribute\",\n          nodeId: '1',\n          resourceId: 'nodeSnmp[]',\n          attribute: '$x',\n          aggregation: 'AVERAGE'\n        }],\n        interval: '1s'\n      };\n      let [query,] = ctx.ds.buildQuery(options);\n\n      expect(query.source.length).to.equal(4);\n      expect(query.source[0].attribute).to.equal(\"a\");\n      expect(query.source[1].attribute).to.equal(\"b\");\n      expect(query.source[2].attribute).to.equal(\"c\");\n      expect(query.source[3].attribute).to.equal(\"d\");\n    });\n\n    it('should perform variable substitution on all filter parameters', function () {\n      ctx.templateSrv.variables = [\n        {name: 'variable', current: {value: ['x', 'y']}}\n      ];\n\n      let options = {\n        range: {from: 'now-1h', to: 'now'},\n        targets: [\n          {\n            type: \"attribute\",\n            nodeId: '1',\n            resourceId: 'nodeSnmp[]',\n            attribute: '$variable',\n            aggregation: 'AVERAGE'\n          },\n          {\n            type: \"filter\",\n            filter: {\n              name: \"some-filter\"\n            },\n            filterParameters: {\n              param1: 1,\n              param2: '$variable'\n            }\n          }\n        ],\n        interval: '1s'\n      };\n      let [query,] = ctx.ds.buildQuery(options);\n\n      expect(query.filter.length).to.equal(2);\n      expect(query.filter[0].name).to.equal(\"some-filter\");\n      expect(query.filter[0].parameter.length).to.equal(2);\n      expect(query.filter[0].parameter[0].key).to.equal(\"param1\");\n      expect(query.filter[0].parameter[0].value).to.equal(1);\n      expect(query.filter[0].parameter[1].key).to.equal(\"param2\");\n      expect(query.filter[0].parameter[1].value).to.equal(\"x\");\n\n      expect(query.filter[1].name).to.equal(\"some-filter\");\n      expect(query.filter[1].parameter.length).to.equal(2);\n      expect(query.filter[1].parameter[0].key).to.equal(\"param1\");\n      expect(query.filter[1].parameter[0].value).to.equal(1);\n      expect(query.filter[1].parameter[1].key).to.equal(\"param2\");\n      expect(query.filter[1].parameter[1].value).to.equal(\"y\");\n    });\n  });\n\n  describe('preserving order', function () {\n      it('should preserve a single label', function () {\n          let options = {\n              range: {from: 'now-1h', to: 'now'},\n              targets: [{\n                  type: \"attribute\",\n                  nodeId: '1',\n                  resourceId: 'nodeSnmp[]',\n                  attribute: 'loadavg1',\n                  aggregation: 'AVERAGE'\n              }],\n              interval: '1s'\n          };\n\n          let [,labels] = ctx.ds.buildQuery(options);\n\n          expect(labels.length).to.equal(1);\n          expect(labels[0]).to.equal(\"loadavg1\");\n      });\n\n      it('should preserve multiple labels', function () {\n          let options = {\n              range: {from: 'now-1h', to: 'now'},\n              targets: [{\n                  type: \"attribute\",\n                  nodeId: '1',\n                  resourceId: 'nodeSnmp[]',\n                  attribute: 'loadavg1',\n                  aggregation: 'AVERAGE'\n              },\n                  {\n                      type: \"attribute\",\n                      nodeId: '1',\n                      resourceId: 'nodeSnmp[]',\n                      attribute: 'loadavg5',\n                      aggregation: 'AVERAGE'\n                  }],\n              interval: '1s'\n          };\n\n          let [,labels] = ctx.ds.buildQuery(options);\n\n          expect(labels.length).to.equal(2);\n          expect(labels[0]).to.equal(\"loadavg1\");\n          expect(labels[1]).to.equal(\"loadavg5\");\n      });\n\n      it('should preserve multiple labels (reverse)', function () {\n          let options = {\n              range: {from: 'now-1h', to: 'now'},\n              targets: [\n                  {\n                      type: \"attribute\",\n                      nodeId: '1',\n                      resourceId: 'nodeSnmp[]',\n                      attribute: 'loadavg5',\n                      aggregation: 'AVERAGE'\n                  },\n                  {\n                      type: \"attribute\",\n                      nodeId: '1',\n                      resourceId: 'nodeSnmp[]',\n                      attribute: 'loadavg1',\n                      aggregation: 'AVERAGE'\n                  }\n              ],\n              interval: '1s'\n          };\n\n          let [,labels] = ctx.ds.buildQuery(options);\n\n          expect(labels.length).to.equal(2);\n          expect(labels[0]).to.equal(\"loadavg5\");\n          expect(labels[1]).to.equal(\"loadavg1\");\n      });\n\n      it('should reorder the series', async function () {\n          let query = {\n              range: {from: 'now-1h', to: 'now'},\n              targets: [\n                  {\n                      type: \"attribute\",\n                      nodeId: '1',\n                      resourceId: 'nodeSnmp[]',\n                      attribute: 'a',\n                      aggregation: 'AVERAGE'\n                  },\n                  {\n                      label: \"b\",\n                      type: \"attribute\",\n                      nodeId: '1',\n                      resourceId: 'nodeSnmp[]',\n                      attribute: 'woot',\n                      aggregation: 'AVERAGE'\n                  },\n                  {\n                      type: \"attribute\",\n                      nodeId: '1',\n                      resourceId: 'nodeSnmp[]',\n                      attribute: 'missing',\n                      aggregation: 'AVERAGE'\n                  },\n                  {\n                      type: \"attribute\",\n                      nodeId: '1',\n                      resourceId: 'nodeSnmp[]',\n                      attribute: '$variable',\n                      aggregation: 'AVERAGE'\n                  },\n              ],\n              scopedVars: {\n                  'variable': {\n                      value: 'c'\n                  }\n              },\n              interval: '1s'\n          };\n\n          let response = {\n              \"step\": 5,\n              \"start\": 0,\n              \"end\": 10,\n              \"timestamps\": [0, 5, 10],\n              'labels': ['a', 'c', 'b'],\n              \"columns\": [\n                  {'values': [1, 2, 3]},\n                  {'values': [9, 9, 9]},\n                  {'values': [3, 2, 1]},\n              ],\n          };\n\n          ctx.templateSrv.variables = [\n              {name: 'variable', current: {value: 'x'}},\n              {name: 'nodeId', current: {value: '1'}},\n          ];\n          ctx.backendSrv.datasourceRequest = function (request) {\n              return ctx.$q.when({\n                  _request: request,\n                  status: 200,\n                  data: response\n              });\n          };\n\n          var result = await ctx.ds.query(query);\n          expect(result.data.length).to.equal(3);\n          expect(result.data[0].target).to.equal('a');\n          expect(result.data[0].datapoints).to.deep.equal([[1, 0], [2, 5], [3, 10]]);\n          expect(result.data[1].target).to.equal('b');\n          expect(result.data[1].datapoints).to.deep.equal([[3, 0], [2, 5], [1, 10]]);\n          expect(result.data[2].target).to.equal('c');\n          expect(result.data[2].datapoints).to.deep.equal([[9, 0], [9, 5], [9, 10]]);\n      });\n\n  });\n});\n"]}